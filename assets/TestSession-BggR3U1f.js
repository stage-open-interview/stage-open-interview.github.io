import{f as te,u as re,r as u,j as e,m as v,T as R,Z as ne,d as ae,g as A,X as P,C as oe,h as ie,H as le,i as D}from"./index-ZSFwugmp.js";import{S as ce}from"./SEOHead-DBOAnWpE.js";import{Q as F}from"./QuestionFeedback-B6xIWCea.js";import{Q as de}from"./QuestionHistory-CvLg1p5M.js";import{D as me}from"./DesktopSidebarWrapper-CfPhqEQM.js";import{g as xe,a as ue,b as pe,c as fe,d as he,e as ge,s as be}from"./tests-wAOJTiwU.js";import{C as je}from"./clock-D5TcLjFt.js";import{A as ye}from"./arrow-left-DSVClN_w.js";import{A as B}from"./mic-CcaTPyBm.js";import{E as L}from"./eye-gT-SjjV_.js";import{C as Ne}from"./circle-x-DSDK4G6b.js";import{E as we}from"./external-link-CJBT-mS7.js";import{S as M}from"./share-2-B7BjgsS-.js";import{R as ve}from"./rotate-ccw-D94BnG5w.js";import"./flag-BlrpKBuj.js";import"./ban-wnF86XZL.js";import"./history-Bb5ujjg8.js";import"./trash-2-Kqa-l6Nk.js";import"./triangle-alert-DJG_bvZe.js";import"./square-pen-BNB2Ikh7.js";import"./plus-BK46xinH.js";import"./user-Bz_W4vf1.js";import"./bot-BQe1ye8o.js";import"./chevron-down-C2yW3kFs.js";import"./UnifiedNav-quOqcfXb.js";import"./use-unified-toast-D-oj_3aw.js";import"./UnifiedSearch-D3F1wG3G.js";import"./tag-DmW7PBzR.js";import"./target-tfcKRnx5.js";import"./chart-column-DvXCm_K7.js";function S(m){return m?m.split(/`([^`]+)`/g).map((g,a)=>a%2===1?e.jsx("code",{className:"px-1.5 py-0.5 mx-0.5 bg-primary/15 text-primary rounded text-[0.9em] font-mono",children:g},a):g):null}const W="test-auto-submit";function Se(){try{const m=localStorage.getItem(W);return m===null?!0:m==="true"}catch{return!0}}function Ce(m){localStorage.setItem(W,String(m))}function ts(){const{channelId:m}=te(),[_,g]=re(),[a,H]=u.useState(null),[h,b]=u.useState("loading"),[p,Y]=u.useState([]),[x,j]=u.useState(0),[d,w]=u.useState({}),[C,X]=u.useState(0),[k,$]=u.useState(0),[o,q]=u.useState(null),[N,K]=u.useState(Se),[f,y]=u.useState(null);u.useEffect(()=>{m&&xe(m).then(s=>{s?(H(s),b("ready")):b("loading")})},[m]),u.useEffect(()=>{if(h!=="in-progress")return;const s=setInterval(()=>{$(Math.floor((Date.now()-C)/1e3))},1e3);return()=>clearInterval(s)},[h,C]);const T=u.useCallback(()=>{if(!a)return;const s=ue(a,15);Y(s),w({}),j(0),X(Date.now()),$(0),q(null),b("in-progress")},[a]),t=p[x],E=pe(a?.id||""),U=s=>{if(!t)return;const r=d[t.id]||[];if(t.type==="single"){const i={...d,[t.id]:[s]};if(w(i),N){const c=t.options.find(n=>n.isCorrect)?.id===s;y(c?"correct":"incorrect"),setTimeout(()=>{y(null),x<p.length-1&&j(x+1)},600)}}else r.includes(s)?w({...d,[t.id]:r.filter(i=>i!==s)}):w({...d,[t.id]:[...r,s]})},V=()=>{const s=!N;K(s),Ce(s)},Z=()=>{x<p.length-1&&j(x+1)},z=()=>{if(!t||t.type!=="multiple")return;const s=d[t.id]||[];if(s.length===0)return;const r=t.options.filter(n=>n.isCorrect).map(n=>n.id),i=r.every(n=>s.includes(n)),l=s.every(n=>r.includes(n));y(i&&l?"correct":"incorrect"),setTimeout(()=>{y(null),x<p.length-1&&j(x+1)},800)},G=()=>{x>0&&j(x-1)},O=()=>{if(!a)return;const s=ge({...a,questions:p},d);q(s);const r={testId:a.id,startedAt:new Date(C).toISOString(),completedAt:new Date().toISOString(),answers:d,score:s.score,passed:s.passed,timeSpent:k};be(a.id,a.channelId,r),b("review"),s.passed?D.celebrate():D.disappointed()},J=()=>p.map(s=>{const r=d[s.id]||[],i=s.options.filter(n=>n.isCorrect),l=i.map(n=>n.id);let c=!1;if(s.type==="single")c=r.length===1&&l.includes(r[0]);else{const n=l.every(I=>r.includes(I)),se=r.every(I=>l.includes(I));c=n&&se&&r.length>0}return{question:s,userAnswers:r,correctOptions:i,isCorrect:c}}),Q=s=>{const r=Math.floor(s/60),i=s%60;return`${r}:${i.toString().padStart(2,"0")}`},ee=Object.keys(d).length;return h==="loading"||!a?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a?"Loading test...":"No test available for this channel yet"}),e.jsx("button",{onClick:()=>g("/"),className:"mt-4 text-primary hover:underline text-sm",children:"Go back home"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:`${a.title} | Code Reels`,description:a.description,canonical:`https://open-interview.github.io/test/${m}`}),e.jsx(me,{children:e.jsxs("div",{className:"min-h-screen bg-background text-foreground font-mono",children:[h==="ready"&&e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-md w-full border border-border bg-card rounded-lg p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(R,{className:"w-8 h-8 text-primary"})}),e.jsx("h1",{className:"text-xl font-bold mb-2",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsxs("div",{className:"space-y-3 mb-6 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Questions"}),e.jsxs("span",{className:"font-bold",children:["15 (random from ",a.questions.length,")"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Passing Score"}),e.jsxs("span",{className:"font-bold",children:[a.passingScore,"%"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Question Types"}),e.jsx("span",{className:"font-bold",children:"Single & Multiple Choice"})]}),E&&e.jsxs("div",{className:"flex justify-between p-2 bg-primary/10 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Your Best"}),e.jsxs("span",{className:"font-bold text-primary",children:[E.bestScore,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:T,className:"w-full py-3 bg-primary text-primary-foreground font-bold rounded hover:bg-primary/90 transition-colors",children:"Start Test"}),e.jsx("button",{onClick:()=>g(`/channel/${m}`),className:"w-full py-2 text-muted-foreground hover:text-foreground transition-colors text-sm",children:"Back to Channel"})]})]})}),h==="in-progress"&&t&&e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("header",{className:"border-b border-border p-3 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[x+1," / ",p.length]}),e.jsx("div",{className:"h-1 w-24 bg-muted/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${(x+1)/p.length*100}%`}})})]}),e.jsxs("button",{onClick:V,className:`flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-medium transition-all ${N?"bg-primary/20 text-primary border border-primary/30":"bg-muted/30 text-muted-foreground border border-transparent"}`,title:N?"Auto-advance ON":"Auto-advance OFF",children:[e.jsx(ne,{className:`w-3 h-3 ${N?"text-primary":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Auto"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(je,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-mono",children:Q(k)})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[ee,"/",p.length," answered"]})]}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(ae,{mode:"wait",children:e.jsxs(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase rounded ${t.type==="multiple"?"bg-purple-500/20 text-purple-400":"bg-blue-500/20 text-blue-400"}`,children:t.type==="multiple"?"Select all that apply":"Single choice"}),t.type==="multiple"&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",(d[t.id]||[]).length," selected)"]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase rounded ${t.difficulty==="beginner"?"bg-green-500/20 text-green-400":t.difficulty==="intermediate"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:t.difficulty}),t.questionId&&e.jsx(de,{questionId:t.questionId,questionType:"test",size:"sm"}),t.questionId&&e.jsx(F,{questionId:t.questionId,className:"ml-auto"})]}),e.jsx("h2",{className:"text-lg font-bold mb-6",children:S(t.question)}),e.jsx("div",{className:"space-y-2",children:t.options.map((s,r)=>{const i=(d[t.id]||[]).includes(s.id),l=f&&s.isCorrect,c=f==="incorrect"&&i&&!s.isCorrect,n=t.type==="multiple";return e.jsx("button",{onClick:()=>U(s.id),disabled:f!==null,className:`w-full p-4 text-left border rounded-lg transition-all ${l?"border-green-500 bg-green-500/20":c?"border-red-500 bg-red-500/20":i?"border-primary bg-primary/10":"border-border hover:border-primary/50"} ${f?"cursor-default":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:`w-6 h-6 ${n?"rounded-md":"rounded-full"} border-2 flex items-center justify-center flex-shrink-0 ${l?"border-green-500 bg-green-500":c?"border-red-500 bg-red-500":i?"border-primary bg-primary":"border-muted-foreground/30"}`,children:[l&&e.jsx(A,{className:"w-4 h-4 text-white"}),c&&e.jsx(P,{className:"w-4 h-4 text-white"}),!f&&i&&e.jsx(A,{className:"w-4 h-4 text-primary-foreground"})]}),e.jsx("span",{className:"text-sm",children:S(s.text)})]})},s.id)})}),t.type==="multiple"&&!f&&e.jsx("p",{className:"mt-3 text-xs text-muted-foreground text-center",children:'Select all correct answers, then click "Confirm" to continue'})]},t.id)})})}),e.jsx("footer",{className:"border-t border-border p-3",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:G,disabled:x===0,className:"flex items-center gap-1 px-4 py-2 text-sm disabled:opacity-30 hover:text-primary transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"})," Previous"]}),e.jsx("div",{className:"flex gap-1 flex-wrap justify-center max-w-xs",children:p.map((s,r)=>e.jsx("button",{onClick:()=>j(r),className:`w-2 h-2 rounded-full transition-colors ${r===x?"bg-primary":d[s.id]?"bg-primary/50":"bg-muted/30"}`},s.id))}),x===p.length-1?t?.type==="multiple"?e.jsx("button",{onClick:()=>{const s=d[t.id]||[];if(s.length===0)return;const r=t.options.filter(n=>n.isCorrect).map(n=>n.id),i=r.every(n=>s.includes(n)),l=s.every(n=>r.includes(n));y(i&&l?"correct":"incorrect"),setTimeout(()=>{y(null),O()},800)},disabled:(d[t.id]||[]).length===0||f!==null,className:"px-4 py-2 bg-primary text-primary-foreground text-sm font-bold rounded hover:bg-primary/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Confirm & Submit"}):e.jsx("button",{onClick:O,className:"px-4 py-2 bg-primary text-primary-foreground text-sm font-bold rounded hover:bg-primary/90 transition-colors",children:"Submit Test"}):t?.type==="multiple"?e.jsxs("button",{onClick:z,disabled:(d[t.id]||[]).length===0||f!==null,className:"flex items-center gap-1 px-4 py-2 text-sm bg-primary text-primary-foreground font-bold rounded hover:bg-primary/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:["Confirm ",e.jsx(B,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:Z,className:"flex items-center gap-1 px-4 py-2 text-sm hover:text-primary transition-colors",children:["Next ",e.jsx(B,{className:"w-4 h-4"})]})]})})]}),h==="review"&&o&&e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("header",{className:"border-b border-border p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-5 h-5 text-primary"}),e.jsx("h1",{className:"font-bold",children:"Review Answers"})]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-bold ${o.passed?"bg-green-500/20 text-green-500":"bg-orange-500/20 text-orange-500"}`,children:[o.score,"% (",o.correct,"/",o.total,")"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:J().map((s,r)=>e.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.05},className:`p-4 border rounded-lg ${s.isCorrect?"border-green-500/30 bg-green-500/5":"border-red-500/30 bg-red-500/5"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ${s.isCorrect?"bg-green-500":"bg-red-500"}`,children:s.isCorrect?e.jsx(A,{className:"w-4 h-4 text-white"}):e.jsx(P,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Q",r+1]}),e.jsx("span",{className:`px-1.5 py-0.5 text-[9px] uppercase rounded ${s.question.difficulty==="beginner"?"bg-green-500/20 text-green-400":s.question.difficulty==="intermediate"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:s.question.difficulty})]}),e.jsx("p",{className:"text-sm font-medium",children:S(s.question.question)})]})]}),e.jsx("div",{className:"space-y-1.5 ml-9 mb-3",children:s.question.options.map(i=>{const l=s.userAnswers.includes(i.id),c=i.isCorrect;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded text-xs ${c?"bg-green-500/20 text-green-400":l?"bg-red-500/20 text-red-400":"text-muted-foreground"}`,children:[c&&e.jsx(oe,{className:"w-3 h-3"}),l&&!c&&e.jsx(Ne,{className:"w-3 h-3"}),!c&&!l&&e.jsx("span",{className:"w-3"}),e.jsx("span",{children:S(i.text)}),l&&e.jsx("span",{className:"ml-auto text-[10px] opacity-70",children:"(your answer)"})]},i.id)})}),!s.isCorrect&&s.question.explanation&&e.jsxs("div",{className:"ml-9 p-2 bg-muted/30 rounded text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Explanation:"})," ",s.question.explanation]}),s.question.questionId&&e.jsxs("div",{className:"ml-9 mt-2 flex items-center gap-2",children:[e.jsxs("a",{href:`/channel/${a.channelId}?q=${s.question.questionId}`,className:"inline-flex items-center gap-1 text-xs text-primary hover:underline",children:[e.jsx(we,{className:"w-3 h-3"}),"View full question & answer"]}),e.jsx(F,{questionId:s.question.questionId})]})]},s.question.id))})}),e.jsx("footer",{className:"border-t border-border p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto flex gap-3",children:e.jsx("button",{onClick:()=>b("completed"),className:"flex-1 py-3 bg-primary text-primary-foreground font-bold rounded-lg hover:bg-primary/90 transition-colors",children:"Continue to Results"})})})]}),h==="completed"&&o&&e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-md w-full border border-border bg-card rounded-lg p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 ${o.passed?"bg-green-500/20":"bg-orange-500/20"}`,children:o.passed?e.jsx(R,{className:"w-10 h-10 text-green-500"}):e.jsx(ie,{className:"w-10 h-10 text-orange-500"})}),e.jsx("h1",{className:"text-2xl font-bold mb-1",children:o.passed?"Congratulations!":"Keep Practicing!"}),e.jsx("p",{className:"text-muted-foreground",children:o.passed?"You passed the test!":`You need ${a.passingScore}% to pass`})]}),e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-6",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",fill:"none",stroke:"currentColor",strokeWidth:"8",className:"text-muted/20"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",fill:"none",stroke:o.passed?"#22c55e":"#f97316",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${o.score/100*352} 352`})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-3xl font-bold",children:[o.score,"%"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.correct,"/",o.total]})]})]}),e.jsxs("div",{className:"space-y-2 mb-6 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Time Spent"}),e.jsx("span",{className:"font-bold",children:Q(k)})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Correct Answers"}),e.jsx("span",{className:"font-bold text-green-500",children:o.correct})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Incorrect"}),e.jsx("span",{className:"font-bold text-red-500",children:o.total-o.correct})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("a",{href:fe(a.channelName,o.score,o.passed),target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 border border-border rounded text-center text-sm hover:bg-muted/20 transition-colors flex items-center justify-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"})," Share on X"]}),e.jsxs("a",{href:he(a.channelName,o.score,o.passed),target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 border border-border rounded text-center text-sm hover:bg-muted/20 transition-colors flex items-center justify-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"})," Share"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>b("review"),className:"w-full py-2 bg-primary text-primary-foreground font-bold rounded hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"})," Review Answers"]}),e.jsxs("button",{onClick:T,className:"w-full py-2 border border-primary text-primary font-bold rounded hover:bg-primary/10 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"})," Try Again"]}),e.jsxs("button",{onClick:()=>g(`/channel/${m}`),className:"w-full py-2 text-muted-foreground hover:text-foreground transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"})," Back to Channel"]})]})]})})]})})]})}export{ts as default};
