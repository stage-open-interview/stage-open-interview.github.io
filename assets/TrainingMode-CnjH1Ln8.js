import{k as X,x as Z,q as ee,r as n,j as e,B as se,h as te,l as re,m as ne,W as ae,t as oe,Y as ie}from"./index-EL3khofa.js";import{S as le}from"./SEOHead-ChI381ev.js";import{A as ce}from"./arrow-left-BRcZ0gD7.js";import{T as de}from"./target-BQK28BAF.js";import{E as ue}from"./eye-DhAApPKU.js";import{M as L}from"./mic-CsJ8CuPu.js";import{C as me}from"./clock-Bk6OUaEr.js";import{V as xe}from"./volume-2-CAFsAquc.js";import{S as ge}from"./square-Bu6n07z_.js";import{P as fe}from"./play-W3TVWBd9.js";import{P as pe}from"./pause-DCL2yqMD.js";import{R as he}from"./rotate-ccw-BSi8t0TF.js";const be=30;function Be(){const[,d]=X(),{getSubscribedChannels:h}=Z(),{balance:W,formatCredits:N,config:u}=ee(),l=h(),[c,b]=n.useState([]),[m,q]=n.useState(0),[$,k]=n.useState(!0),[F,U]=n.useState([]),[we,D]=n.useState(0),[a,x]=n.useState({isRecording:!1,isPaused:!1,duration:0,wordCount:0,audioBlob:null,transcript:"",finalTranscript:""}),[O,z]=n.useState(new Set),[ye,Y]=n.useState(!1),[B,E]=n.useState(!1),[j,w]=n.useState({isPlaying:!1,currentWordIndex:-1,words:[]}),v=n.useRef(null),C=n.useRef([]),T=n.useRef(null),g=n.useRef(null),R=n.useRef(null),S=n.useRef(null),i=c[m],P=F.reduce((t,s)=>t+s.wordCount,0);n.useEffect(()=>{if(B)return;(async()=>{if(console.log("TrainingMode: Starting to load questions"),console.log("TrainingMode: Subscribed channels:",l.length),k(!0),l.length===0){console.log("TrainingMode: No subscribed channels"),k(!1),E(!0);return}try{const s=[];for(const r of l)try{console.log(`TrainingMode: Loading channel ${r.id}`);const o=await ie.getData(r.id);console.log(`TrainingMode: Loaded ${o.questions.length} questions from ${r.id}`),s.push(...o.questions)}catch(o){console.error(`TrainingMode: Failed to load ${r.id}`,o)}if(console.log(`TrainingMode: Total questions loaded: ${s.length}`),s.length>0){const o=s.sort(()=>Math.random()-.5).slice(0,20);console.log(`TrainingMode: Selected ${o.length} questions for training`),b(o)}}catch(s){console.error("TrainingMode: Failed to load questions",s)}k(!1),E(!0)})()},[l,B]),n.useEffect(()=>{if(!i?.answer)return;const t=je(i.answer,be);U(t),D(t.length-1),Y(!0),x({isRecording:!1,isPaused:!1,duration:0,wordCount:0,audioBlob:null,transcript:"",finalTranscript:""}),w({isPlaying:!1,currentWordIndex:-1,words:[]})},[i]),n.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.webkitSpeechRecognition||window.SpeechRecognition,s=new t;s.continuous=!0,s.interimResults=!0,s.lang="en-US",s.onresult=r=>{let o="",y="";for(let f=r.resultIndex;f<r.results.length;f++){const A=r.results[f][0].transcript;r.results[f].isFinal?y+=A+" ":o+=A}const p=y+o,I=Q(p);x(f=>({...f,wordCount:I,transcript:p,finalTranscript:y||f.finalTranscript}))},g.current=s}return()=>{if(g.current)try{g.current.stop()}catch{}}},[]);const _=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(t);C.current=[],s.ondataavailable=r=>{r.data.size>0&&C.current.push(r.data)},s.onstop=()=>{const r=new Blob(C.current,{type:"audio/webm"});x(o=>({...o,audioBlob:r})),t.getTracks().forEach(o=>o.stop())},s.start(),v.current=s,g.current&&g.current.start(),T.current=setInterval(()=>{x(r=>({...r,duration:r.duration+1}))},1e3),x(r=>({...r,isRecording:!0,isPaused:!1}))}catch(t){console.error("Failed to start recording:",t),alert("Microphone access denied. Please enable microphone permissions.")}},G=()=>{if(v.current&&v.current.state!=="inactive"&&v.current.stop(),g.current)try{g.current.stop()}catch{}T.current&&clearInterval(T.current),x(t=>({...t,isRecording:!1})),i&&z(t=>new Set(t).add(i.id))},H=()=>{x({isRecording:!1,isPaused:!1,duration:0,wordCount:0,audioBlob:null,transcript:"",finalTranscript:""}),w({isPlaying:!1,currentWordIndex:-1,words:[]})},V=()=>{if(!a.audioBlob)return;const t=URL.createObjectURL(a.audioBlob),s=new Audio(t);R.current=s;const r=a.finalTranscript.trim().split(/\s+/);w({isPlaying:!0,currentWordIndex:0,words:r});const o=a.duration*1e3,y=r.length>0?o/r.length:0;let p=0;S.current=setInterval(()=>{p++,p>=r.length?M():w(I=>({...I,currentWordIndex:p}))},y),s.onended=()=>{M()},s.play()},M=()=>{R.current&&(R.current.pause(),R.current=null),S.current&&(clearInterval(S.current),S.current=null),w({isPlaying:!1,currentWordIndex:-1,words:[]})},J=()=>{m<c.length-1?q(t=>t+1):d("/")},K=()=>{m>0&&q(t=>t-1)};return $?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading training questions..."})]})}):c.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(se,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Questions Available"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Subscribe to channels to access training questions"}),e.jsx("button",{onClick:()=>d("/channels"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg font-semibold",children:"Browse Channels"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(le,{title:"Training Mode - Practice Speaking Answers",description:"Read and record technical interview answers to improve your speaking skills"}),e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur border-b border-border",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>d("/"),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-lg",children:[e.jsx(de,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-semibold",children:[m+1," / ",c.length]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 rounded-lg",children:[e.jsx(te,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-semibold text-green-500",children:O.size})]})]})]}),e.jsx("div",{className:"h-1 bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${(m+1)/c.length*100}%`}})})]}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-6",children:e.jsx(re,{mode:"wait",children:e.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl border border-border p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:i.question}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${i.difficulty==="beginner"?"bg-green-500/10 text-green-600":i.difficulty==="intermediate"?"bg-yellow-500/10 text-yellow-600":"bg-red-500/10 text-red-600"}`,children:i.difficulty}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:i.channel})]})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:"Answer to Read"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[P," words"]})]}),e.jsx("div",{className:"max-w-none overflow-auto max-h-96",children:e.jsx("p",{className:"text-foreground leading-relaxed whitespace-pre-wrap break-words",children:i.answer})})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-primary"}),"Record Your Answer"]}),a.duration>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"font-mono",children:[Math.floor(a.duration/60),":",(a.duration%60).toString().padStart(2,"0")]})]})]}),(a.isRecording||a.transcript)&&e.jsxs("div",{className:"mb-4 p-4 bg-muted/30 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:a.isRecording?"Live Transcription":"Your Recording"}),a.isRecording&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-500",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),"Recording..."]})]}),e.jsx("div",{className:"text-sm leading-relaxed break-words overflow-auto max-h-96",children:j.isPlaying?e.jsx("div",{className:"flex flex-wrap gap-1",children:j.words.map((t,s)=>e.jsx("span",{className:`transition-all duration-200 ${s===j.currentWordIndex?"bg-primary text-primary-foreground px-1 rounded font-semibold scale-110":s<j.currentWordIndex?"text-muted-foreground":"text-foreground"}`,children:t},s))}):e.jsx("p",{className:"text-foreground whitespace-pre-wrap",children:a.transcript||"Start speaking..."})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Words spoken"}),e.jsxs("span",{className:"font-semibold",children:[a.wordCount," words"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${Math.min(a.wordCount/Math.max(P,1)*100,100)}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Target: ~",P," words (full answer)"]})]}),e.jsxs("div",{className:"flex gap-3",children:[!a.isRecording&&!a.audioBlob&&e.jsxs("button",{onClick:_,className:"flex-1 py-3 px-6 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:[e.jsx(L,{className:"w-5 h-5"}),"Start Recording"]}),a.isRecording&&e.jsxs("button",{onClick:G,className:"flex-1 py-3 px-6 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors animate-pulse",children:[e.jsx(ge,{className:"w-5 h-5"}),"Stop Recording"]}),a.audioBlob&&e.jsxs(e.Fragment,{children:[j.isPlaying?e.jsxs("button",{onClick:M,className:"flex-1 py-3 px-6 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:[e.jsx(pe,{className:"w-5 h-5"}),"Stop Playback"]}):e.jsxs("button",{onClick:V,className:"flex-1 py-3 px-6 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:[e.jsx(fe,{className:"w-5 h-5"}),"Play Recording"]}),e.jsx("button",{onClick:H,className:"py-3 px-6 bg-muted hover:bg-muted/80 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:e.jsx(he,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:`ðŸ’¡ Tip: Read the full answer naturally. Click "Stop Recording" when you're done.`})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:K,disabled:m===0,className:"px-6 py-3 bg-muted hover:bg-muted/80 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors",children:"Previous"}),e.jsxs("button",{onClick:J,className:"flex-1 px-6 py-3 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:[m===c.length-1?"Finish":"Next Question",e.jsx(oe,{className:"w-5 h-5"})]})]})]},i.id)})})]})]})}function je(d,h){const W=d.match(/[^.!?]+[.!?]+/g)||[d],N=[];let u="",l=0;for(const c of W){const b=Q(c);l+b>h&&u?(N.push({text:u.trim(),wordCount:l,isRevealed:!1}),u=c,l=b):(u+=" "+c,l+=b)}return u.trim()&&N.push({text:u.trim(),wordCount:l,isRevealed:!1}),N}function Q(d){return d.trim().split(/\s+/).filter(h=>h.length>0).length}export{Be as default};
