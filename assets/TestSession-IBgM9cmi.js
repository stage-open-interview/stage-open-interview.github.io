import{h as se,u as te,r as u,j as e,m as v,T as P,Z as re,A as ne,i as $,X as Q,C as ae,k as le,H as oe,l as B}from"./index-DaVim63q.js";import{S as ie}from"./SEOHead-lt9duIEQ.js";import{g as ce,a as de,b as me,c as xe,d as ue,e as pe,s as he}from"./tests-wAOJTiwU.js";import{C as fe}from"./clock-Bl3HedTW.js";import{A as ge}from"./arrow-left-BqS6Zbf3.js";import{A as F}from"./arrow-right-CPirRxXj.js";import{E as L}from"./eye-CDJk8amT.js";import{C as be}from"./circle-x-Burhw0QS.js";import{E as je}from"./external-link-Y0Pmkf-J.js";import{S as M}from"./share-2-AzgtfTm5.js";import{R as ye}from"./rotate-ccw-DuqLnMDb.js";function S(m){return m?m.split(/`([^`]+)`/g).map((g,a)=>a%2===1?e.jsx("code",{className:"px-1.5 py-0.5 mx-0.5 bg-primary/15 text-primary rounded text-[0.9em] font-mono",children:g},a):g):null}const D="test-auto-submit";function Ne(){try{const m=localStorage.getItem(D);return m===null?!0:m==="true"}catch{return!0}}function we(m){localStorage.setItem(D,String(m))}function Re(){const{channelId:m}=se(),[_,g]=te(),[a,W]=u.useState(null),[f,b]=u.useState("loading"),[p,Y]=u.useState([]),[x,j]=u.useState(0),[d,w]=u.useState({}),[C,H]=u.useState(0),[k,T]=u.useState(0),[l,I]=u.useState(null),[N,X]=u.useState(Ne),[h,y]=u.useState(null);u.useEffect(()=>{m&&ce(m).then(s=>{s?(W(s),b("ready")):b("loading")})},[m]),u.useEffect(()=>{if(f!=="in-progress")return;const s=setInterval(()=>{T(Math.floor((Date.now()-C)/1e3))},1e3);return()=>clearInterval(s)},[f,C]);const q=u.useCallback(()=>{if(!a)return;const s=de(a,15);Y(s),w({}),j(0),H(Date.now()),T(0),I(null),b("in-progress")},[a]),t=p[x],E=me(a?.id||""),K=s=>{if(!t)return;const r=d[t.id]||[];if(t.type==="single"){const o={...d,[t.id]:[s]};if(w(o),N){const c=t.options.find(n=>n.isCorrect)?.id===s;y(c?"correct":"incorrect"),setTimeout(()=>{y(null),x<p.length-1&&j(x+1)},600)}}else r.includes(s)?w({...d,[t.id]:r.filter(o=>o!==s)}):w({...d,[t.id]:[...r,s]})},U=()=>{const s=!N;X(s),we(s)},V=()=>{x<p.length-1&&j(x+1)},Z=()=>{if(!t||t.type!=="multiple")return;const s=d[t.id]||[];if(s.length===0)return;const r=t.options.filter(n=>n.isCorrect).map(n=>n.id),o=r.every(n=>s.includes(n)),i=s.every(n=>r.includes(n));y(o&&i?"correct":"incorrect"),setTimeout(()=>{y(null),x<p.length-1&&j(x+1)},800)},G=()=>{x>0&&j(x-1)},O=()=>{if(!a)return;const s=pe({...a,questions:p},d);I(s);const r={testId:a.id,startedAt:new Date(C).toISOString(),completedAt:new Date().toISOString(),answers:d,score:s.score,passed:s.passed,timeSpent:k};he(a.id,a.channelId,r),b("review"),s.passed?B.celebrate():B.disappointed()},z=()=>p.map(s=>{const r=d[s.id]||[],o=s.options.filter(n=>n.isCorrect),i=o.map(n=>n.id);let c=!1;if(s.type==="single")c=r.length===1&&i.includes(r[0]);else{const n=i.every(A=>r.includes(A)),ee=r.every(A=>i.includes(A));c=n&&ee&&r.length>0}return{question:s,userAnswers:r,correctOptions:o,isCorrect:c}}),R=s=>{const r=Math.floor(s/60),o=s%60;return`${r}:${o.toString().padStart(2,"0")}`},J=Object.keys(d).length;return f==="loading"||!a?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a?"Loading test...":"No test available for this channel yet"}),e.jsx("button",{onClick:()=>g("/"),className:"mt-4 text-primary hover:underline text-sm",children:"Go back home"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:`${a.title} | Code Reels`,description:a.description,canonical:`https://open-interview.github.io/test/${m}`}),e.jsxs("div",{className:"min-h-screen bg-background text-foreground font-mono",children:[f==="ready"&&e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-md w-full border border-border bg-card rounded-lg p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(P,{className:"w-8 h-8 text-primary"})}),e.jsx("h1",{className:"text-xl font-bold mb-2",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsxs("div",{className:"space-y-3 mb-6 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Questions"}),e.jsxs("span",{className:"font-bold",children:["15 (random from ",a.questions.length,")"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Passing Score"}),e.jsxs("span",{className:"font-bold",children:[a.passingScore,"%"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Question Types"}),e.jsx("span",{className:"font-bold",children:"Single & Multiple Choice"})]}),E&&e.jsxs("div",{className:"flex justify-between p-2 bg-primary/10 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Your Best"}),e.jsxs("span",{className:"font-bold text-primary",children:[E.bestScore,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:q,className:"w-full py-3 bg-primary text-primary-foreground font-bold rounded hover:bg-primary/90 transition-colors",children:"Start Test"}),e.jsx("button",{onClick:()=>g(`/channel/${m}`),className:"w-full py-2 text-muted-foreground hover:text-foreground transition-colors text-sm",children:"Back to Channel"})]})]})}),f==="in-progress"&&t&&e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("header",{className:"border-b border-border p-3 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[x+1," / ",p.length]}),e.jsx("div",{className:"h-1 w-24 bg-muted/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${(x+1)/p.length*100}%`}})})]}),e.jsxs("button",{onClick:U,className:`flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-medium transition-all ${N?"bg-primary/20 text-primary border border-primary/30":"bg-muted/30 text-muted-foreground border border-transparent"}`,title:N?"Auto-advance ON":"Auto-advance OFF",children:[e.jsx(re,{className:`w-3 h-3 ${N?"text-primary":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Auto"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(fe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-mono",children:R(k)})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[J,"/",p.length," answered"]})]}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(ne,{mode:"wait",children:e.jsxs(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase rounded ${t.type==="multiple"?"bg-purple-500/20 text-purple-400":"bg-blue-500/20 text-blue-400"}`,children:t.type==="multiple"?"Select all that apply":"Single choice"}),t.type==="multiple"&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",(d[t.id]||[]).length," selected)"]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase rounded ${t.difficulty==="beginner"?"bg-green-500/20 text-green-400":t.difficulty==="intermediate"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:t.difficulty})]}),e.jsx("h2",{className:"text-lg font-bold mb-6",children:S(t.question)}),e.jsx("div",{className:"space-y-2",children:t.options.map((s,r)=>{const o=(d[t.id]||[]).includes(s.id),i=h&&s.isCorrect,c=h==="incorrect"&&o&&!s.isCorrect,n=t.type==="multiple";return e.jsx("button",{onClick:()=>K(s.id),disabled:h!==null,className:`w-full p-4 text-left border rounded-lg transition-all ${i?"border-green-500 bg-green-500/20":c?"border-red-500 bg-red-500/20":o?"border-primary bg-primary/10":"border-border hover:border-primary/50"} ${h?"cursor-default":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:`w-6 h-6 ${n?"rounded-md":"rounded-full"} border-2 flex items-center justify-center flex-shrink-0 ${i?"border-green-500 bg-green-500":c?"border-red-500 bg-red-500":o?"border-primary bg-primary":"border-muted-foreground/30"}`,children:[i&&e.jsx($,{className:"w-4 h-4 text-white"}),c&&e.jsx(Q,{className:"w-4 h-4 text-white"}),!h&&o&&e.jsx($,{className:"w-4 h-4 text-primary-foreground"})]}),e.jsx("span",{className:"text-sm",children:S(s.text)})]})},s.id)})}),t.type==="multiple"&&!h&&e.jsx("p",{className:"mt-3 text-xs text-muted-foreground text-center",children:'Select all correct answers, then click "Confirm" to continue'})]},t.id)})})}),e.jsx("footer",{className:"border-t border-border p-3",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:G,disabled:x===0,className:"flex items-center gap-1 px-4 py-2 text-sm disabled:opacity-30 hover:text-primary transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"})," Previous"]}),e.jsx("div",{className:"flex gap-1 flex-wrap justify-center max-w-xs",children:p.map((s,r)=>e.jsx("button",{onClick:()=>j(r),className:`w-2 h-2 rounded-full transition-colors ${r===x?"bg-primary":d[s.id]?"bg-primary/50":"bg-muted/30"}`},s.id))}),x===p.length-1?t?.type==="multiple"?e.jsx("button",{onClick:()=>{const s=d[t.id]||[];if(s.length===0)return;const r=t.options.filter(n=>n.isCorrect).map(n=>n.id),o=r.every(n=>s.includes(n)),i=s.every(n=>r.includes(n));y(o&&i?"correct":"incorrect"),setTimeout(()=>{y(null),O()},800)},disabled:(d[t.id]||[]).length===0||h!==null,className:"px-4 py-2 bg-primary text-primary-foreground text-sm font-bold rounded hover:bg-primary/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Confirm & Submit"}):e.jsx("button",{onClick:O,className:"px-4 py-2 bg-primary text-primary-foreground text-sm font-bold rounded hover:bg-primary/90 transition-colors",children:"Submit Test"}):t?.type==="multiple"?e.jsxs("button",{onClick:Z,disabled:(d[t.id]||[]).length===0||h!==null,className:"flex items-center gap-1 px-4 py-2 text-sm bg-primary text-primary-foreground font-bold rounded hover:bg-primary/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:["Confirm ",e.jsx(F,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:V,className:"flex items-center gap-1 px-4 py-2 text-sm hover:text-primary transition-colors",children:["Next ",e.jsx(F,{className:"w-4 h-4"})]})]})})]}),f==="review"&&l&&e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("header",{className:"border-b border-border p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-5 h-5 text-primary"}),e.jsx("h1",{className:"font-bold",children:"Review Answers"})]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-bold ${l.passed?"bg-green-500/20 text-green-500":"bg-orange-500/20 text-orange-500"}`,children:[l.score,"% (",l.correct,"/",l.total,")"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:z().map((s,r)=>e.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.05},className:`p-4 border rounded-lg ${s.isCorrect?"border-green-500/30 bg-green-500/5":"border-red-500/30 bg-red-500/5"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ${s.isCorrect?"bg-green-500":"bg-red-500"}`,children:s.isCorrect?e.jsx($,{className:"w-4 h-4 text-white"}):e.jsx(Q,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Q",r+1]}),e.jsx("span",{className:`px-1.5 py-0.5 text-[9px] uppercase rounded ${s.question.difficulty==="beginner"?"bg-green-500/20 text-green-400":s.question.difficulty==="intermediate"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:s.question.difficulty})]}),e.jsx("p",{className:"text-sm font-medium",children:S(s.question.question)})]})]}),e.jsx("div",{className:"space-y-1.5 ml-9 mb-3",children:s.question.options.map(o=>{const i=s.userAnswers.includes(o.id),c=o.isCorrect;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded text-xs ${c?"bg-green-500/20 text-green-400":i?"bg-red-500/20 text-red-400":"text-muted-foreground"}`,children:[c&&e.jsx(ae,{className:"w-3 h-3"}),i&&!c&&e.jsx(be,{className:"w-3 h-3"}),!c&&!i&&e.jsx("span",{className:"w-3"}),e.jsx("span",{children:S(o.text)}),i&&e.jsx("span",{className:"ml-auto text-[10px] opacity-70",children:"(your answer)"})]},o.id)})}),!s.isCorrect&&s.question.explanation&&e.jsxs("div",{className:"ml-9 p-2 bg-muted/30 rounded text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Explanation:"})," ",s.question.explanation]}),s.question.questionId&&e.jsx("div",{className:"ml-9 mt-2",children:e.jsxs("a",{href:`/channel/${a.channelId}?q=${s.question.questionId}`,className:"inline-flex items-center gap-1 text-xs text-primary hover:underline",children:[e.jsx(je,{className:"w-3 h-3"}),"View full question & answer"]})})]},s.question.id))})}),e.jsx("footer",{className:"border-t border-border p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto flex gap-3",children:e.jsx("button",{onClick:()=>b("completed"),className:"flex-1 py-3 bg-primary text-primary-foreground font-bold rounded-lg hover:bg-primary/90 transition-colors",children:"Continue to Results"})})})]}),f==="completed"&&l&&e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-md w-full border border-border bg-card rounded-lg p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 ${l.passed?"bg-green-500/20":"bg-orange-500/20"}`,children:l.passed?e.jsx(P,{className:"w-10 h-10 text-green-500"}):e.jsx(le,{className:"w-10 h-10 text-orange-500"})}),e.jsx("h1",{className:"text-2xl font-bold mb-1",children:l.passed?"Congratulations!":"Keep Practicing!"}),e.jsx("p",{className:"text-muted-foreground",children:l.passed?"You passed the test!":`You need ${a.passingScore}% to pass`})]}),e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-6",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",fill:"none",stroke:"currentColor",strokeWidth:"8",className:"text-muted/20"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",fill:"none",stroke:l.passed?"#22c55e":"#f97316",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${l.score/100*352} 352`})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-3xl font-bold",children:[l.score,"%"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.correct,"/",l.total]})]})]}),e.jsxs("div",{className:"space-y-2 mb-6 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Time Spent"}),e.jsx("span",{className:"font-bold",children:R(k)})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Correct Answers"}),e.jsx("span",{className:"font-bold text-green-500",children:l.correct})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/20 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Incorrect"}),e.jsx("span",{className:"font-bold text-red-500",children:l.total-l.correct})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("a",{href:xe(a.channelName,l.score,l.passed),target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 border border-border rounded text-center text-sm hover:bg-muted/20 transition-colors flex items-center justify-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"})," Share on X"]}),e.jsxs("a",{href:ue(a.channelName,l.score,l.passed),target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 border border-border rounded text-center text-sm hover:bg-muted/20 transition-colors flex items-center justify-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"})," Share"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>b("review"),className:"w-full py-2 bg-primary text-primary-foreground font-bold rounded hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"})," Review Answers"]}),e.jsxs("button",{onClick:q,className:"w-full py-2 border border-primary text-primary font-bold rounded hover:bg-primary/10 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"})," Try Again"]}),e.jsxs("button",{onClick:()=>g(`/channel/${m}`),className:"w-full py-2 text-muted-foreground hover:text-foreground transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"})," Back to Channel"]})]})]})})]})]})}export{Re as default};
