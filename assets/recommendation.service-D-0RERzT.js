import{A as w,P as u}from"./index-B4uMxRHM.js";const h="user-engagement-data",m="last-new-content-check";function g(){if(typeof window>"u")return{channels:{},lastGlobalVisit:new Date().toISOString(),totalVisits:0};try{const e=localStorage.getItem(h);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load engagement data:",e)}return{channels:{},lastGlobalVisit:new Date().toISOString(),totalVisits:0}}function C(e){if(!(typeof window>"u"))try{localStorage.setItem(h,JSON.stringify(e))}catch(t){console.error("Failed to save engagement data:",t)}}const v={trackChannelVisit(e){const t=g(),n=new Date().toISOString();t.channels[e]||(t.channels[e]={channelId:e,visitCount:0,lastVisited:n,completedCount:0,markedCount:0}),t.channels[e].visitCount++,t.channels[e].lastVisited=n,t.lastGlobalVisit=n,t.totalVisits++,t.channels[e].completedCount=u.getCompleted(e).length,t.channels[e].markedCount=u.getMarked(e).length,C(t)},getTopChannels(e=5){const t=g();return Object.values(t.channels).map(n=>({...n,score:n.visitCount*2+n.completedCount*3+n.markedCount*1})).sort((n,s)=>s.score-n.score).slice(0,e)},async findNewQuestions(e){if(!e)return[];const t=g(),n=[];if(Object.keys(t.channels).length===0)return[];for(const[d,c]of Object.entries(e.questions)){const l=c.latestEvent?.createdAt;if(!l)continue;const a=new Date(l),o=new Date(t.lastGlobalVisit);a>o&&n.push({questionId:d,channelId:"",createdAt:l,questionType:c.questionType==="coding"?"coding":"question"})}return n.sort((d,c)=>new Date(c.createdAt).getTime()-new Date(d.createdAt).getTime())},async generateRecommendations(e,t){g();const n=[],s=this.getTopChannels(10);for(const a of s.slice(0,3)){const o=u.getCompleted(a.channelId),r=t[a.channelId]||0;if(r>0&&o.length<r){const i=Math.round(o.length/r*100);n.push({type:"continue",channelId:a.channelId,reason:`Continue your progress (${i}% complete)`,priority:100-i})}}if(e){const a=localStorage.getItem(m),o=a?new Date(a):new Date(0);for(const r of s){let i=0;for(const[,f]of Object.entries(e.questions)){const p=f.latestEvent?.createdAt;p&&new Date(p)>o&&i++}i>0&&n.push({type:"new_content",channelId:r.channelId,reason:`${i} new question${i>1?"s":""} added`,priority:90,newCount:i})}localStorage.setItem(m,new Date().toISOString())}for(const a of s){const o=u.getMarked(a.channelId);o.length>0&&n.push({type:"review",channelId:a.channelId,reason:`${o.length} question${o.length>1?"s":""} marked for review`,priority:70,questionIds:o})}const d={"system-design":["backend","database","devops"],algorithms:["data-structures","dynamic-programming"],frontend:["react-native","testing"],backend:["database","system-design","devops"],aws:["aws-saa","aws-dva","terraform"],kubernetes:["cka","ckad","devops"],"machine-learning":["generative-ai","nlp","computer-vision"]},c=new Set(s.map(a=>a.channelId)),l=new Set;for(const a of s.slice(0,3)){const o=d[a.channelId]||[];for(const r of o)!c.has(r)&&!l.has(r)&&(l.add(r),n.push({type:"explore",channelId:r,reason:`Related to ${a.channelId}`,priority:50}))}return n.sort((a,o)=>o.priority-a.priority).slice(0,8)},getEngagementSummary(){const e=g(),t=Object.values(e.channels);return{totalChannelsVisited:t.length,totalQuestionsCompleted:t.reduce((n,s)=>n+s.completedCount,0),currentStreak:w.getStreak(),topChannel:t.length>0?t.sort((n,s)=>s.visitCount-n.visitCount)[0].channelId:null}},clearEngagementData(){typeof window>"u"||(localStorage.removeItem(h),localStorage.removeItem(m))}};export{v as R};
