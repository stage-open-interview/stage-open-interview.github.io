import{a3 as le,a4 as re,r as t,a5 as oe,u as ie,d as ce,e as de,a6 as V,j as e,m as a,K as X,Z as L,o as xe,l as z,i as w,X as Y,T as ee,a7 as me}from"./index-Bd4OfHjt.js";import{S as ue}from"./SEOHead-DMy2H_zX.js";import{U as pe}from"./UnifiedSearch-ClhsMaBY.js";import{g as he,r as ge,c as be,a as fe,M as B,b as F,h as U,v as K,d as je}from"./index-C5YrK7h1.js";import{C as Ne}from"./use-unified-toast-CTLjDvXk.js";import{C as W}from"./copy-C6wadhDd.js";import{E as ye}from"./eye-C-FzVgPf.js";import{T as we}from"./target-DhIvVmUJ.js";import{F as ve}from"./tag-Dn0a4MoH.js";import"./arrow-right-CW9QK2F-.js";import"./loader-circle-BLr-gu0E.js";function Ce(){!le.current&&re();const[d]=t.useState(oe.current);return d}function Z(d){if(!d)return"";let n=d;return n=n.replace(/([^\n])(```)/g,`$1
$2`),n=n.replace(/(```\w*)\s*\n?\s*([^\n`])/g,`$1
$2`),n=n.replace(/^\*\*\s*$/gm,""),n=n.replace(/\*\*\s*\n\s*([^*]+)\*\*/g,"**$1**"),n=n.replace(/^[•·]\s*/gm,"- "),n}function De(){const[,d]=ie(),[n,h]=t.useState("loading"),[l,v]=t.useState([]),[c,A]=t.useState(0),[x,D]=t.useState(null),[o,P]=t.useState(null),[f,E]=t.useState(0),[M,k]=t.useState({again:0,hard:0,good:0,easy:0}),[N,j]=t.useState(0),[C,b]=t.useState(!1),[H,Q]=t.useState([]),[i,p]=t.useState(!1),[q,S]=t.useState(""),[T,R]=t.useState(null);Ce();const{onSRSReview:O}=ce(),{trackEvent:_}=de(),y=t.useCallback((s="light")=>{if("vibrate"in navigator){const r={light:10,medium:20,heavy:30};navigator.vibrate(r[s])}},[]);t.useEffect(()=>{const s=he();v(s),s.length===0?h("completed"):$(s[0])},[]);const $=t.useCallback(s=>{const r=V(s.questionId);r&&(D(r),P(s),h("reviewing"),b(!1))},[]),se=t.useCallback(s=>{if(!o||!x)return;ge(o.questionId,o.channel,o.difficulty,s);const r=be(s,o.masteryLevel);fe(r),j(u=>u+r),O(s),_({type:"srs_review",timestamp:new Date().toISOString(),data:{rating:s}}),k(u=>({...u,[s]:u[s]+1}));const g=f+1;E(g),y("medium"),Q(u=>[...u,o]),console.log(`[Checkpoint Debug] Reviewed: ${g}, Next: ${c+1}, Total: ${l.length}`);const m=c+1;if(g%5===0&&m<l.length){console.log(`[Checkpoint] Triggering at question ${g}`),A(m),h("checkpoint");return}m<l.length?(A(m),$(l[m])):h("completed")},[o,x,f,c,l,O,_,y,$]),te=t.useCallback(s=>{console.log(`[Checkpoint] Completed with score: ${s}`),y("heavy"),c<l.length?$(l[c]):h("completed")},[c,l,$,y]),ae=l.length>0?Math.round(f/l.length*100):0,G=t.useCallback(s=>{S(s),p(!0),y("light")},[y]),J=t.useCallback((s,r)=>{navigator.clipboard.writeText(s),R(r),setTimeout(()=>R(null),2e3)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"Review Session | Code Reels",description:"Spaced repetition review with checkpoint tests"}),e.jsxs("div",{className:"min-h-screen min-h-dvh bg-gradient-to-br from-background via-background to-green-500/5 flex flex-col",children:[e.jsxs(a.header,{className:"h-12 bg-card/90 backdrop-blur-xl border-b border-border/50 flex items-center px-3 gap-3 shrink-0",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},children:[e.jsx(a.button,{onClick:()=>d("/"),whileTap:{scale:.92},className:"p-1.5 hover:bg-secondary rounded-lg transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})}),e.jsx(X,{className:"w-4 h-4 text-green-500"}),e.jsx("h1",{className:"font-bold text-sm",children:"SRS Review"}),e.jsx("div",{className:"flex-1"}),l.length>0&&n!=="completed"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-medium",children:[f,"/",l.length]}),e.jsx("div",{className:"w-16 h-1.5 bg-secondary rounded-full overflow-hidden",children:e.jsx(a.div,{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500",initial:{width:0},animate:{width:`${ae}%`}})})]}),N>0&&e.jsxs(a.div,{initial:{scale:0},animate:{scale:1},className:"flex items-center gap-1 px-2 py-0.5 bg-purple-500/20 rounded-lg",children:[e.jsx(L,{className:"w-3 h-3 text-purple-400"}),e.jsx("span",{className:"text-xs font-bold text-purple-400",children:N})]})]}),e.jsxs(xe,{mode:"wait",children:[n==="loading"&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(a.div,{className:"w-10 h-10 border-2 border-green-500 border-t-transparent rounded-full mx-auto mb-3",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading..."})]})},"loading"),n==="reviewing"&&x&&o&&e.jsxs(a.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(a.button,{onClick:()=>G(o.channel),whileTap:{scale:.95},className:"px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs font-semibold rounded-full border border-cyan-500/30 hover:bg-cyan-500/30 transition-colors cursor-pointer",children:o.channel}),e.jsx(a.button,{onClick:()=>G(o.difficulty),whileTap:{scale:.95},className:z("px-2 py-0.5 text-xs font-semibold rounded-full border hover:opacity-80 transition-opacity cursor-pointer",o.difficulty==="beginner"?"bg-green-500/20 text-green-400 border-green-500/30":o.difficulty==="intermediate"?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"bg-red-500/20 text-red-400 border-red-500/30"),children:o.difficulty}),x.tags&&x.tags.slice(0,3).map((s,r)=>e.jsx(a.button,{onClick:()=>G(s),whileTap:{scale:.95},className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 text-xs font-semibold rounded-full border border-purple-500/30 hover:bg-purple-500/30 transition-colors cursor-pointer",children:s},r))]}),e.jsx("h2",{className:"text-lg font-bold leading-tight",children:x.question}),C&&e.jsxs(a.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-2",children:[x.tldr&&e.jsxs("div",{className:"p-2 bg-cyan-500/10 border border-cyan-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(L,{className:"w-3 h-3 text-cyan-400"}),e.jsx("span",{className:"text-xs font-bold text-cyan-400",children:"TL;DR"})]}),e.jsx("p",{className:"text-sm text-foreground/90",children:x.tldr})]}),e.jsxs("div",{className:"p-2 bg-green-500/10 border border-green-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(w,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{className:"text-xs font-bold text-green-400",children:"ANSWER"})]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-sm",children:e.jsx(B,{remarkPlugins:[F],components:{code({className:s,children:r,...g}){const m=/language-(\w+)/.exec(s||""),u=String(r).replace(/\n$/,""),I=`answer-code-${Math.random().toString(36).substr(2,9)}`;return!!m&&m?e.jsxs("div",{className:"relative group my-2",children:[e.jsx("button",{onClick:()=>J(u,I),className:"absolute top-1 right-1 p-1.5 rounded-lg bg-secondary/80 hover:bg-secondary transition-all opacity-0 group-hover:opacity-100 z-10",children:T===I?e.jsx(w,{className:"w-3 h-3 text-green-400"}):e.jsx(W,{className:"w-3 h-3"})}),e.jsx(U,{style:K,language:m[1],PreTag:"div",className:"rounded-lg !bg-black/40 !my-0 !text-xs !p-2",...g,children:u})]}):e.jsx("code",{className:"px-1 py-0.5 rounded bg-primary/15 text-primary text-xs font-mono",...g,children:r})},p:({children:s})=>e.jsx("p",{className:"text-sm leading-relaxed mb-2 last:mb-0",children:s}),ul:({children:s})=>e.jsx("ul",{className:"text-sm space-y-1 mb-2",children:s}),ol:({children:s})=>e.jsx("ol",{className:"text-sm space-y-1 mb-2",children:s}),li:({children:s})=>e.jsx("li",{className:"text-sm",children:s})},children:Z(x.answer)})})]}),x.explanation&&e.jsxs("div",{className:"p-2 bg-orange-500/10 border border-orange-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(X,{className:"w-3 h-3 text-orange-400"}),e.jsx("span",{className:"text-xs font-bold text-orange-400",children:"EXPLANATION"})]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-xs",children:e.jsx(B,{remarkPlugins:[F],components:{code({className:s,children:r,...g}){const m=/language-(\w+)/.exec(s||""),u=String(r).replace(/\n$/,""),I=`exp-code-${Math.random().toString(36).substr(2,9)}`;return!!m&&m?e.jsxs("div",{className:"relative group my-2",children:[e.jsx("button",{onClick:()=>J(u,I),className:"absolute top-1 right-1 p-1.5 rounded-lg bg-secondary/80 hover:bg-secondary transition-all opacity-0 group-hover:opacity-100 z-10",children:T===I?e.jsx(w,{className:"w-3 h-3 text-green-400"}):e.jsx(W,{className:"w-3 h-3"})}),e.jsx(U,{style:K,language:m[1],PreTag:"div",className:"rounded-lg !bg-black/40 !my-0 !text-xs !p-2",...g,children:u})]}):e.jsx("code",{className:"px-1 py-0.5 rounded bg-primary/15 text-primary text-xs font-mono",...g,children:r})},p:({children:s})=>e.jsx("p",{className:"text-xs leading-relaxed text-foreground/80 mb-2 last:mb-0",children:s}),ul:({children:s})=>e.jsx("ul",{className:"text-xs space-y-1 mb-2",children:s}),ol:({children:s})=>e.jsx("ol",{className:"text-xs space-y-1 mb-2",children:s}),li:({children:s})=>e.jsx("li",{className:"text-xs",children:s})},children:Z(x.explanation)})})]})]})]})}),e.jsx("div",{className:"shrink-0 pb-safe bg-card/90 backdrop-blur-xl border-t border-border/50",children:C?e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"How well did you remember?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{rating:"again",label:"Again",color:"from-red-500 to-red-600",icon:Y},{rating:"hard",label:"Hard",color:"from-orange-500 to-orange-600",icon:X},{rating:"good",label:"Good",color:"from-green-500 to-green-600",icon:w},{rating:"easy",label:"Easy",color:"from-blue-500 to-blue-600",icon:L}].map(s=>{const r=s.icon;return e.jsxs(a.button,{onClick:()=>se(s.rating),whileTap:{scale:.92},className:z("flex flex-col items-center gap-1 py-2.5 rounded-xl text-white","bg-gradient-to-br shadow-lg hover:shadow-xl min-h-[44px]",s.color),children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-semibold",children:s.label})]},s.rating)})})]}):e.jsx(a.button,{onClick:()=>{b(!0),y("light")},whileTap:{scale:.98},className:"w-full p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Tap to reveal answer"})]})})})]},`review-${o.questionId}`),n==="checkpoint"&&e.jsx(Se,{reviewedCount:f,recentCards:H,onComplete:te}),n==="completed"&&e.jsx(ke,{stats:M,totalReviewed:f,sessionXP:N,onGoHome:()=>d("/")})]})]}),e.jsx(pe,{isOpen:i,onClose:()=>{p(!1),S("")},initialQuery:q})]})}function Se({reviewedCount:d,recentCards:n,onComplete:h}){const[l,v]=t.useState(0),[c,A]=t.useState({}),[x,D]=t.useState(!1),[o,P]=t.useState(!1),[f,E]=t.useState(null),M=n.slice(-5),k=M[l],N=k?V(k.questionId):null,j=M.length,C=Object.keys(c).length,b=Object.values(c).filter(Boolean).length,H=(i,p)=>{navigator.clipboard.writeText(i),E(p),setTimeout(()=>E(null),2e3)},Q=i=>{A(p=>({...p,[l]:i})),P(!0),setTimeout(()=>{l<j-1?(v(p=>p+1),P(!1)):D(!0)},1500)};return N?e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex-1 flex flex-col bg-gradient-to-br from-background via-background to-amber-500/5",children:[e.jsxs("div",{className:"h-12 bg-card/90 backdrop-blur-xl border-b border-border/50 flex items-center px-3 gap-3",children:[e.jsx(we,{className:"w-4 h-4 text-amber-500"}),e.jsx("h1",{className:"font-bold text-sm",children:"Checkpoint Test"}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-xs font-medium",children:[C,"/",j]})]}),x?e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md w-full",children:[e.jsx(a.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",duration:.8},className:"w-16 h-16 rounded-full bg-amber-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(ee,{className:"w-8 h-8 text-amber-500"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Checkpoint Complete!"}),e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-xl mb-4",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-400 mb-1",children:[b,"/",j]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b===j?"Perfect!":b>=4?"Great job!":b>=3?"Good!":"Keep practicing!"})]}),e.jsx(a.button,{onClick:()=>h(b),whileTap:{scale:.95},className:"w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold shadow-lg",children:"Continue Reviewing"})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Q",l+1,"/",j]}),e.jsxs("span",{className:"text-xs font-bold text-amber-500",children:["Score: ",b,"/",C]})]}),e.jsx("div",{className:"h-1.5 bg-secondary rounded-full overflow-hidden",children:e.jsx(a.div,{className:"h-full bg-gradient-to-r from-amber-500 to-orange-500",animate:{width:`${C/j*100}%`}})})]}),e.jsxs(a.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-card/90 border border-border/50 rounded-xl p-3 mb-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs font-semibold rounded-full",children:k.channel})}),e.jsx("h2",{className:"text-base font-bold mb-3 leading-tight",children:N.question}),o&&e.jsxs(a.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"p-2 bg-green-500/10 border border-green-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(w,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{className:"text-xs font-bold text-green-400",children:"ANSWER"})]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-sm",children:e.jsx(B,{remarkPlugins:[F],components:{code({className:i,children:p,...q}){const S=/language-(\w+)/.exec(i||""),T=String(p).replace(/\n$/,""),R=`checkpoint-code-${Math.random().toString(36).substr(2,9)}`;return!!S&&S?e.jsxs("div",{className:"relative group my-2",children:[e.jsx("button",{onClick:()=>H(T,R),className:"absolute top-1 right-1 p-1.5 rounded-lg bg-secondary/80 hover:bg-secondary transition-all opacity-0 group-hover:opacity-100 z-10",children:f===R?e.jsx(w,{className:"w-3 h-3 text-green-400"}):e.jsx(W,{className:"w-3 h-3"})}),e.jsx(U,{style:K,language:S[1],PreTag:"div",className:"rounded-lg !bg-black/40 !my-0 !text-xs !p-2",...q,children:T})]}):e.jsx("code",{className:"px-1 py-0.5 rounded bg-primary/15 text-primary text-xs font-mono",...q,children:p})},p:({children:i})=>e.jsx("p",{className:"text-sm leading-relaxed mb-2 last:mb-0",children:i}),ul:({children:i})=>e.jsx("ul",{className:"text-sm space-y-1 mb-2",children:i}),ol:({children:i})=>e.jsx("ol",{className:"text-sm space-y-1 mb-2",children:i}),li:({children:i})=>e.jsx("li",{className:"text-sm",children:i})},children:Z(N.answer)})})]})]},l),!o&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(a.button,{onClick:()=>Q(!1),whileTap:{scale:.95},className:"flex flex-col items-center gap-1.5 py-3 rounded-xl bg-gradient-to-br from-red-500 to-red-600 text-white shadow-lg min-h-[56px]",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-semibold",children:"Don't Remember"})]}),e.jsxs(a.button,{onClick:()=>Q(!0),whileTap:{scale:.95},className:"flex flex-col items-center gap-1.5 py-3 rounded-xl bg-gradient-to-br from-green-500 to-green-600 text-white shadow-lg min-h-[56px]",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-semibold",children:"Remember"})]})]})]})})]},"checkpoint"):null}function ke({stats:d,totalReviewed:n,sessionXP:h,onGoHome:l}){const v=je();return e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},className:"flex-1 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md w-full",children:[e.jsxs(a.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",duration:.8},className:"w-20 h-20 rounded-full bg-yellow-400/20 flex items-center justify-center mx-auto mb-4 relative",children:[e.jsx(ee,{className:"w-10 h-10 text-yellow-500"}),e.jsx(a.div,{initial:{scale:0},animate:{scale:[0,1.2,1]},transition:{delay:.5},className:"absolute -top-1 -right-1",children:e.jsx(me,{className:"w-5 h-5 text-yellow-400 fill-yellow-400"})})]}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:n===0?"All Caught Up!":"Session Complete!"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n===0?"No cards due.":`Reviewed ${n} cards!`}),h>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 rounded-full mb-4",children:[e.jsx(L,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"text-lg font-bold text-purple-400",children:["+",h," XP"]})]}),n>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4 p-3 bg-secondary/30 rounded-xl",children:[{label:"Again",value:d.again,color:"text-red-500"},{label:"Hard",value:d.hard,color:"text-orange-500"},{label:"Good",value:d.good,color:"text-green-500"},{label:"Easy",value:d.easy,color:"text-blue-500"}].map(c=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:z("text-lg font-bold",c.color),children:c.value}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c.label})]},c.label))}),v.reviewStreak>0&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx(ve,{className:"w-5 h-5 text-orange-500"}),e.jsxs("span",{className:"text-sm font-bold text-orange-500",children:[v.reviewStreak," day streak!"]})]}),e.jsx(a.button,{onClick:l,whileTap:{scale:.95},className:"w-full py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold shadow-lg",children:"Back to Home"})]})},"completed")}export{De as default};
