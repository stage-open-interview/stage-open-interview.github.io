import{j as e,C as B,r as t,u as U,q as W,B as D,A as V,m as z,S as O,p as H,V as Y}from"./index-CkhVBA_0.js";import{S as _}from"./SEOHead-DazwDgHF.js";import{V as G}from"./volume-2-DaascHTs.js";import{M as E}from"./mic-CSDJzJ6i.js";import{S as J}from"./square-C4nqINMT.js";import{P as K}from"./play-CGWatA9W.js";import{R as X}from"./rotate-ccw-DvTFtHdO.js";import{P as Z}from"./pause-Bzx6lswv.js";import{C as ee}from"./clock-xqr71Z3c.js";import{A as se}from"./arrow-left-DekX-5Xk.js";import{T as re}from"./target-CTH2rqPk.js";import{E as te}from"./eye-g2KZpR0-.js";function ne({transcript:n,interimTranscript:o="",isRecording:u=!1,isPlaying:l=!1,playbackWords:m=[],currentWordIndex:r=-1,title:i,placeholder:s="Start speaking...",className:h="",maxHeight:b="max-h-96"}){const C=n||o;return e.jsxs("div",{className:`p-4 bg-muted/30 rounded-lg border border-border ${h}`,children:[i&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:i}),u&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-500",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),"Recording..."]})]}),e.jsx("div",{className:`text-sm leading-relaxed break-words overflow-auto whitespace-pre-wrap ${b}`,children:l&&m.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:m.map((j,y)=>e.jsx("span",{className:`transition-all duration-200 ${y===r?"bg-primary text-primary-foreground px-1 rounded font-semibold scale-110":y<r?"text-muted-foreground":"text-foreground"}`,children:j},y))}):C?e.jsxs("p",{className:"text-foreground",children:[n,o&&e.jsx("span",{className:"text-muted-foreground",children:o}),u&&e.jsx("span",{className:"animate-pulse",children:"|"})]}):e.jsx("p",{className:"text-muted-foreground",children:s})})]})}function ae({state:n,onStart:o,onStop:u,onReset:l,onSubmit:m,onPlay:r,onStopPlayback:i,disabled:s=!1,submitLabel:h="Submit Answer",className:b=""}){return e.jsxs("div",{className:`flex items-center justify-center gap-3 ${b}`,children:[n==="idle"&&e.jsxs("button",{onClick:o,disabled:s,className:"flex items-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(E,{className:"w-5 h-5"}),"Start Recording"]}),n==="recording"&&e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-colors animate-pulse",children:[e.jsx(J,{className:"w-5 h-5"}),"Stop Recording"]}),n==="recorded"&&e.jsxs(e.Fragment,{children:[r&&e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold transition-colors",children:[e.jsx(K,{className:"w-4 h-4"}),"Play"]}),l&&e.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-4 py-2 bg-muted hover:bg-muted/80 rounded-lg font-semibold transition-colors",children:[e.jsx(X,{className:"w-4 h-4"}),"Re-record"]}),m&&e.jsxs("button",{onClick:m,disabled:s,className:"flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(B,{className:"w-5 h-5"}),h]})]}),n==="playing"&&i&&e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),"Stop Playback"]})]})}function oe({currentWords:n,targetWords:o,label:u="Words spoken",showTarget:l=!0,className:m=""}){const r=Math.min(o?n/o*100:n*2,100);return e.jsxs("div",{className:m,children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:u}),e.jsxs("span",{className:"font-semibold",children:[n," ",o&&l&&`/ ${o}`," words"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${r}%`}})}),o&&l&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Target: ~",o," words"]})]})}function ie({seconds:n,isRecording:o=!1,className:u=""}){const l=Math.floor(n/60),m=n%60,r=`${l}:${m.toString().padStart(2,"0")}`;return e.jsxs("div",{className:`flex items-center gap-2 text-sm ${u}`,children:[o&&e.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-mono",children:r})]})}function ce({recording:n,targetWords:o,showTranscript:u=!0,showWordCount:l=!0,showTimer:m=!0,tip:r,className:i=""}){const{state:s,startRecording:h,stopRecording:b,resetRecording:C,playRecording:j,stopPlayback:y,isPlaying:v,currentWordIndex:a,playbackWords:S}=n,w=v?"playing":s.audioBlob?"recorded":s.isRecording?"recording":"idle";return e.jsxs("div",{className:`bg-card rounded-xl border border-border p-6 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-primary"}),"Record Your Answer"]}),m&&s.duration>0&&e.jsx(ie,{seconds:s.duration,isRecording:s.isRecording})]}),u&&(s.isRecording||s.transcript)&&e.jsx(ne,{transcript:s.transcript,isRecording:s.isRecording,isPlaying:v,playbackWords:S,currentWordIndex:a,title:s.isRecording?"Live Transcription":"Your Recording",className:"mb-4"}),l&&e.jsx(oe,{currentWords:s.wordCount,targetWords:o,className:"mb-4"}),e.jsx(ae,{state:w,onStart:h,onStop:b,onReset:C,onPlay:j,onStopPlayback:y}),r&&e.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:["ðŸ’¡ ",r]})})]})}const le=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window);function de(n={}){const{autoStart:o=!1,maxDuration:u,onTranscriptUpdate:l,onRecordingComplete:m,onError:r}=n,[i,s]=t.useState({isRecording:!1,isPaused:!1,duration:0,wordCount:0,audioBlob:null,transcript:"",finalTranscript:""}),[h,b]=t.useState(!1),[C,j]=t.useState(-1),[y,v]=t.useState([]),a=t.useRef(null),S=t.useRef([]),w=t.useRef(null),g=t.useRef(null),N=t.useRef(null),p=t.useRef(null);t.useEffect(()=>{if(!le)return;const d=window.webkitSpeechRecognition||window.SpeechRecognition,x=new d;return x.continuous=!0,x.interimResults=!0,x.lang="en-US",x.onresult=c=>{let k="",$="";for(let P=c.resultIndex;P<c.results.length;P++){const q=c.results[P][0].transcript;c.results[P].isFinal?$+=q+" ":k+=q}const T=$+k,I=ue(T);s(P=>({...P,wordCount:I,transcript:T,finalTranscript:$||P.finalTranscript})),l&&l(T,I)},x.onerror=c=>{console.error("Speech recognition error:",c.error),r&&r(new Error(`Speech recognition error: ${c.error}`))},g.current=x,()=>{if(g.current)try{g.current.stop()}catch{}}},[l,r]),t.useEffect(()=>{o&&R()},[o]),t.useEffect(()=>{u&&i.duration>=u&&i.isRecording&&f()},[i.duration,u,i.isRecording]);const R=t.useCallback(async()=>{try{const d=await navigator.mediaDevices.getUserMedia({audio:!0}),x=new MediaRecorder(d);if(S.current=[],x.ondataavailable=c=>{c.data.size>0&&S.current.push(c.data)},x.onstop=()=>{const c=new Blob(S.current,{type:"audio/webm"});s(k=>({...k,audioBlob:c})),d.getTracks().forEach(k=>k.stop()),m&&m(c,i.finalTranscript)},x.start(),a.current=x,g.current)try{g.current.start()}catch{console.warn("Speech recognition already started")}w.current=setInterval(()=>{s(c=>({...c,duration:c.duration+1}))},1e3),s(c=>({...c,isRecording:!0,isPaused:!1}))}catch(d){console.error("Failed to start recording:",d),r&&r(d)}},[m,r,i.finalTranscript]),f=t.useCallback(()=>{if(a.current&&a.current.state!=="inactive"&&a.current.stop(),g.current)try{g.current.stop()}catch{}w.current&&clearInterval(w.current),s(d=>({...d,isRecording:!1}))},[]),L=t.useCallback(()=>{if(a.current&&a.current.state==="recording"&&a.current.pause(),g.current)try{g.current.stop()}catch{}w.current&&clearInterval(w.current),s(d=>({...d,isPaused:!0}))},[]),Q=t.useCallback(()=>{if(a.current&&a.current.state==="paused"&&a.current.resume(),g.current)try{g.current.start()}catch{console.warn("Speech recognition already started")}w.current=setInterval(()=>{s(d=>({...d,duration:d.duration+1}))},1e3),s(d=>({...d,isPaused:!1}))},[]),A=t.useCallback(()=>{f(),s({isRecording:!1,isPaused:!1,duration:0,wordCount:0,audioBlob:null,transcript:"",finalTranscript:""}),b(!1),j(-1),v([])},[f]),F=t.useCallback(()=>{if(!i.audioBlob)return;const d=URL.createObjectURL(i.audioBlob),x=new Audio(d);N.current=x;const c=i.finalTranscript.trim().split(/\s+/);v(c),b(!0),j(0);const k=i.duration*1e3,$=c.length>0?k/c.length:0;let T=0;p.current=setInterval(()=>{T++,T>=c.length?M():j(T)},$),x.onended=()=>{M()},x.play()},[i.audioBlob,i.finalTranscript,i.duration]),M=t.useCallback(()=>{N.current&&(N.current.pause(),N.current=null),p.current&&(clearInterval(p.current),p.current=null),b(!1),j(-1)},[]);return{state:i,startRecording:R,stopRecording:f,pauseRecording:L,resumeRecording:Q,resetRecording:A,playRecording:F,stopPlayback:M,isPlaying:h,currentWordIndex:C,playbackWords:y}}function ue(n){return n.trim().split(/\s+/).filter(o=>o.length>0).length}function Se(){const[,n]=U(),{getSubscribedChannels:o}=W(),u=o(),[l,m]=t.useState([]),[r,i]=t.useState(0),[s,h]=t.useState(!0),[b,C]=t.useState(new Set),[j,y]=t.useState(!1),v=de({onRecordingComplete:(N,p)=>{a&&C(R=>new Set(R).add(a.id))}}),a=l[r],S=a?.answer?me(a.answer):0;t.useEffect(()=>{if(j)return;(async()=>{if(console.log("TrainingMode: Starting to load questions"),console.log("TrainingMode: Subscribed channels:",u.length),h(!0),u.length===0){console.log("TrainingMode: No subscribed channels"),h(!1),y(!0);return}try{const p=[];for(const R of u)try{console.log(`TrainingMode: Loading channel ${R.id}`);const f=await Y.getData(R.id);console.log(`TrainingMode: Loaded ${f.questions.length} questions from ${R.id}`),p.push(...f.questions)}catch(f){console.error(`TrainingMode: Failed to load ${R.id}`,f)}if(console.log(`TrainingMode: Total questions loaded: ${p.length}`),p.length>0){const f=p.sort(()=>Math.random()-.5).slice(0,20);console.log(`TrainingMode: Selected ${f.length} questions for training`),m(f)}}catch(p){console.error("TrainingMode: Failed to load questions",p)}h(!1),y(!0)})()},[u,j]),t.useEffect(()=>{a?.answer&&v.resetRecording()},[a]);const w=()=>{r<l.length-1?i(N=>N+1):n("/")},g=()=>{r>0&&i(N=>N-1)};return s?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading training questions..."})]})}):l.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(D,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Questions Available"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Subscribe to channels to access training questions"}),e.jsx("button",{onClick:()=>n("/channels"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg font-semibold",children:"Browse Channels"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Training Mode - Practice Speaking Answers",description:"Read and record technical interview answers to improve your speaking skills"}),e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur border-b border-border",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>n("/"),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-lg",children:[e.jsx(re,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-semibold",children:[r+1," / ",l.length]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 rounded-lg",children:[e.jsx(B,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-semibold text-green-500",children:b.size})]})]})]}),e.jsx("div",{className:"h-1 bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${(r+1)/l.length*100}%`}})})]}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-6",children:e.jsx(V,{mode:"wait",children:e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl border border-border p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(O,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:a.question}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${a.difficulty==="beginner"?"bg-green-500/10 text-green-600":a.difficulty==="intermediate"?"bg-yellow-500/10 text-yellow-600":"bg-red-500/10 text-red-600"}`,children:a.difficulty}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:a.channel})]})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:"Answer to Read"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[S," words"]})]}),e.jsx("div",{className:"max-w-none overflow-auto max-h-96",children:e.jsx("p",{className:"text-foreground leading-relaxed whitespace-pre-wrap break-words",children:a.answer})})]})]}),e.jsx(ce,{recording:v,targetWords:S,showTranscript:!0,showWordCount:!0,showTimer:!0,tip:"Read the full answer naturally. Click 'Stop Recording' when you're done.",className:""}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:g,disabled:r===0,className:"px-6 py-3 bg-muted hover:bg-muted/80 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors",children:"Previous"}),e.jsxs("button",{onClick:w,className:"flex-1 px-6 py-3 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:[r===l.length-1?"Finish":"Next Question",e.jsx(H,{className:"w-5 h-5"})]})]})]},a.id)})})]})]})}function me(n){return n.trim().split(/\s+/).filter(o=>o.length>0).length}export{Se as default};
