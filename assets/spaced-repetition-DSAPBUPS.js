const f="code-reels-srs",c="code-reels-srs-stats";const v=[1,3,7],d=180;function h(a,n){let{interval:t,easeFactor:e,repetitions:r}=a;switch(n){case"again":return{interval:1,easeFactor:Math.max(1.3,e-.2),repetitions:0};case"hard":return{interval:Math.max(1,Math.round(t*1.2)),easeFactor:Math.max(1.3,e-.15),repetitions:r+1};case"good":let s;return r<v.length?s=v[r]:s=Math.round(t*e),{interval:Math.min(d,s),easeFactor:e,repetitions:r+1};case"easy":let l;return r<v.length?l=v[Math.min(r+1,v.length-1)]*1.5:l=Math.round(t*e*1.3),{interval:Math.min(d,Math.round(l)),easeFactor:Math.min(3,e+.1),repetitions:r+1}}}function p(a){const{repetitions:n,interval:t,correctStreak:e}=a;return n===0?0:t>=90&&e>=5?5:t>=30&&e>=4?4:t>=14&&e>=3?3:t>=7&&e>=2?2:n>=1?1:0}function w(){try{const a=localStorage.getItem(f);if(!a)return new Map;const n=JSON.parse(a);return new Map(Object.entries(n))}catch{return new Map}}function m(a){const n=Object.fromEntries(a);localStorage.setItem(f,JSON.stringify(n))}function R(a,n,t){const r=w().get(a);return r||{questionId:a,channel:n,difficulty:t,interval:0,easeFactor:2.5,repetitions:0,nextReview:new Date().toISOString().split("T")[0],lastReview:"",totalReviews:0,correctStreak:0,masteryLevel:0}}function y(a,n,t,e){const r=w(),i=R(a,n,t),{interval:s,easeFactor:l,repetitions:S}=h(i,e),o=new Date().toISOString().split("T")[0],g=new Date;g.setDate(g.getDate()+s);const u={...i,interval:s,easeFactor:l,repetitions:S,nextReview:g.toISOString().split("T")[0],lastReview:o,totalReviews:i.totalReviews+1,correctStreak:e==="again"?0:i.correctStreak+1,masteryLevel:0};return u.masteryLevel=p(u),r.set(a,u),m(r),M(),u}function x(){const a=w(),n=new Date().toISOString().split("T")[0];return Array.from(a.values()).filter(t=>t.nextReview<=n).sort((t,e)=>t.nextReview!==e.nextReview?t.nextReview.localeCompare(e.nextReview):t.masteryLevel-e.masteryLevel)}function D(){const a=w(),n=new Date().toISOString().split("T")[0],t=new Date;t.setDate(t.getDate()+1);const e=t.toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()+7);const i=r.toISOString().split("T")[0],s=Array.from(a.values()),l=localStorage.getItem(c),S=l?JSON.parse(l):{reviewStreak:0,lastReviewDate:null};return{totalCards:s.length,dueToday:s.filter(o=>o.nextReview<=n).length,dueTomorrow:s.filter(o=>o.nextReview===e).length,dueThisWeek:s.filter(o=>o.nextReview<=i).length,mastered:s.filter(o=>o.masteryLevel>=4).length,learning:s.filter(o=>o.masteryLevel>0&&o.masteryLevel<4).length,newToday:s.filter(o=>o.lastReview===n&&o.totalReviews===1).length,reviewStreak:S.reviewStreak,lastReviewDate:S.lastReviewDate}}function M(){const a=new Date().toISOString().split("T")[0],n=localStorage.getItem(c),t=n?JSON.parse(n):{reviewStreak:0,lastReviewDate:null};if(t.lastReviewDate===a)return;const e=new Date;e.setDate(e.getDate()-1);const r=e.toISOString().split("T")[0];t.lastReviewDate===r?t.reviewStreak+=1:t.lastReviewDate!==a&&(t.reviewStreak=1),t.lastReviewDate=a,localStorage.setItem(c,JSON.stringify(t))}function T(a,n,t){const e=w();if(e.has(a))return e.get(a);const r={questionId:a,channel:n,difficulty:t,interval:1,easeFactor:2.5,repetitions:0,nextReview:new Date().toISOString().split("T")[0],lastReview:"",totalReviews:0,correctStreak:0,masteryLevel:0};return e.set(a,r),m(e),r}function O(a){return["New","Learning","Familiar","Proficient","Expert","Mastered"][Math.min(a,5)]}function I(a){return["text-muted-foreground","text-blue-500","text-cyan-500","text-green-500","text-purple-500","text-yellow-500"][Math.min(a,5)]}function A(a){return["ðŸŒ±","ðŸ“š","ðŸŒ¿","ðŸŒ³","â­","ðŸ‘‘"][Math.min(a,5)]}function E(a,n){const t={again:5,hard:10,good:15,easy:20},e=n*2;return t[a]+e}function L(){const a=localStorage.getItem(c),t=(a?JSON.parse(a):{totalXP:0}).totalXP||0,e=Math.floor(Math.sqrt(t/100))+1,r=Math.pow(e-1,2)*100,i=Math.pow(e,2)*100,s=i-t,l=(t-r)/(i-r)*100;return{totalXP:t,level:e,xpToNext:s,progress:Math.max(0,Math.min(100,l))}}function C(a){const n=localStorage.getItem(c),t=n?JSON.parse(n):{totalXP:0,reviewStreak:0,lastReviewDate:null},e=Math.floor(Math.sqrt((t.totalXP||0)/100))+1;t.totalXP=(t.totalXP||0)+a;const r=Math.floor(Math.sqrt(t.totalXP/100))+1;return localStorage.setItem(c,JSON.stringify(t)),{totalXP:t.totalXP,level:r,leveledUp:r>e}}function F(a){const n=["again","hard","good","easy"],t={};for(const e of n){const{interval:r}=h(a,e);r===1?t[e]="1d":r<7?t[e]=`${r}d`:r<30?t[e]=`${Math.round(r/7)}w`:t[e]=`${Math.round(r/30)}mo`}return t}export{O as a,I as b,A as c,E as d,C as e,F as f,x as g,D as h,L as i,T as j,R as k,y as r};
