import{r as n,ah as x,Q as k,j as u}from"./index-CDhiOAW3.js";import{d as h,i as y,e as E,f as S}from"./text-to-speech-JKTbiyjG.js";import{L}from"./loader-circle-Qc3Tyj3g.js";import{V as j}from"./volume-x-D1h2WJin.js";import{V as w}from"./volume-2-BqNwGSSO.js";const C="user-preferences",g={role:null,subscribedChannels:[],onboardingComplete:!1,createdAt:new Date().toISOString()};function T(){const[r,a]=n.useState(()=>{if(typeof window>"u")return g;try{const e=localStorage.getItem(C);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load preferences:",e)}return g});n.useEffect(()=>{try{localStorage.setItem(C,JSON.stringify(r))}catch(e){console.error("Failed to save preferences:",e)}},[r]);const f=n.useCallback(e=>{const o=x(e).map(b=>b.id);a(b=>({...b,role:e,subscribedChannels:o,onboardingComplete:!0}))},[]),i=n.useCallback(e=>{a(s=>s.subscribedChannels.includes(e)?s:{...s,subscribedChannels:[...s.subscribedChannels,e]})},[]),t=n.useCallback(e=>{a(s=>({...s,subscribedChannels:s.subscribedChannels.filter(o=>o!==e)}))},[]),l=n.useCallback(e=>{a(s=>s.subscribedChannels.includes(e)?{...s,subscribedChannels:s.subscribedChannels.filter(o=>o!==e)}:{...s,subscribedChannels:[...s.subscribedChannels,e]})},[]),d=n.useCallback(e=>r.subscribedChannels.includes(e),[r.subscribedChannels]),c=n.useCallback(()=>k.filter(e=>r.subscribedChannels.includes(e.id)),[r.subscribedChannels]),m=n.useCallback(()=>{a(g),localStorage.removeItem(C)},[]),p=n.useCallback(()=>{const e=["system-design","algorithms","frontend","backend","database","devops"];a(s=>({...s,subscribedChannels:e,onboardingComplete:!0}))},[]);return{preferences:r,setRole:f,subscribeChannel:i,unsubscribeChannel:t,toggleSubscription:l,isSubscribed:d,getSubscribedChannels:c,resetPreferences:m,skipOnboarding:p,needsOnboarding:!r.onboardingComplete}}function V({text:r,label:a="Listen",className:f="",size:i="md"}){const[t,l]=n.useState(!1),[d,c]=n.useState(!1),m=y();n.useEffect(()=>{const o=setInterval(()=>{!S()&&t&&l(!1)},100);return()=>clearInterval(o)},[t]),n.useEffect(()=>()=>{t&&h()},[t]);const p=()=>{t?(h(),l(!1)):(c(!0),E(r,{onStart:()=>{c(!1),l(!0)},onEnd:()=>{l(!1)},onError:()=>{c(!1),l(!1)}}),setTimeout(()=>{c(!1),S()&&l(!0)},500))};if(!m)return null;const e={sm:"px-2 py-1 text-xs gap-1",md:"px-3 py-1.5 text-sm gap-1.5",lg:"px-4 py-2 text-base gap-2"},s={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return u.jsxs("button",{onClick:p,disabled:d,className:`
        inline-flex items-center rounded-lg font-medium transition-all
        ${t?"bg-primary text-primary-foreground":"bg-primary/10 text-primary hover:bg-primary/20"}
        ${e[i]}
        ${f}
        disabled:opacity-50
      `,title:t?"Stop listening":"Listen to answer",children:[d?u.jsx(L,{className:`${s[i]} animate-spin`}):t?u.jsx(j,{className:s[i]}):u.jsx(w,{className:s[i]}),u.jsx("span",{children:t?"Stop":a})]})}export{V as L,T as u};
