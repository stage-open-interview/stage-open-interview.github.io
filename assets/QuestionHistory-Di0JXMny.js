import{r as d,j as e,l as N,m as p,X as C,R as u,n as $,k as H,I as D}from"./index-CDhiOAW3.js";import{H as b}from"./history-ne6zd4H4.js";import{T as F}from"./trash-2-D-_H-60B.js";import{T}from"./triangle-alert-BJcV0wOH.js";import{S as E,F as M,a as w}from"./square-pen-D4MPZT8T.js";import{P as A}from"./plus-Bg7TrAik.js";import{U as P}from"./user-C9aqSd2D.js";import{B as L}from"./bot-nAzHtbYn.js";import{C as O}from"./clock-BtHste8w.js";import{C as R}from"./chevron-down-CGO8lxwA.js";let m=null;const f=new Map,v={created:{icon:A,text:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/30",label:"Created"},updated:{icon:E,text:"text-blue-400",bg:"bg-blue-500/10",border:"border-blue-500/30",label:"Updated"},improved:{icon:H,text:"text-purple-400",bg:"bg-purple-500/10",border:"border-purple-500/30",label:"Improved"},flagged:{icon:T,text:"text-amber-400",bg:"bg-amber-500/10",border:"border-amber-500/30",label:"Flagged"},verified:{icon:$,text:"text-emerald-400",bg:"bg-emerald-500/10",border:"border-emerald-500/30",label:"Verified"},enriched:{icon:u,text:"text-cyan-400",bg:"bg-cyan-500/10",border:"border-cyan-500/30",label:"Enriched"},deleted:{icon:F,text:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30",label:"Deleted"},restored:{icon:u,text:"text-teal-400",bg:"bg-teal-500/10",border:"border-teal-500/30",label:"Restored"}},Q={bot:L,user:P,system:w,import:M};async function U(){if(m)return m;try{const t=await fetch("/data/history/index.json");if(t.ok){const a=t.headers.get("content-type");if(a?.includes("application/json")||a?.includes("text/plain"))return m=await t.json(),m;const r=await t.text();if(r.startsWith("{"))return m=JSON.parse(r),m}}catch{}return null}async function B(t){if(f.has(t))return f.get(t);try{const a=await fetch(`/data/history/${t}.json`);if(a.ok){const r=a.headers.get("content-type");if(r?.includes("application/json")||r?.includes("text/plain")){const s=await a.json();return f.set(t,s),s}const i=await a.text();if(i.startsWith("{")){const s=JSON.parse(i);return f.set(t,s),s}}}catch{}return null}function I(t){const a=new Date(t),r=new Date,i=r.getTime()-a.getTime(),s=Math.floor(i/6e4),o=Math.floor(i/36e5),l=Math.floor(i/864e5);return s<1?"just now":s<60?`${s}m ago`:o<24?`${o}h ago`:l<7?`${l}d ago`:l<30?`${Math.floor(l/7)}w ago`:a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:a.getFullYear()!==r.getFullYear()?"numeric":void 0})}function ee({questionId:t,questionType:a="question",size:r="sm",className:i=""}){const[s,o]=d.useState(!1),[l,h]=d.useState(null),[x,S]=d.useState(null),[k,g]=d.useState(!1);d.useEffect(()=>{U().then(n=>{n?.questions[t]&&h(n.questions[t])})},[t]);const j=d.useCallback(async()=>{if(x)return;g(!0);const n=await B(t);S(n),g(!1)},[t,x]);d.useEffect(()=>{s&&j()},[s,j]);const c=l?.totalEvents||x?.totalEvents||0;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),o(!0)},className:`
          p-2 rounded-lg transition-all inline-flex items-center gap-1.5
          ${c>0?"bg-green-500/10 text-green-500 border border-green-500/30 hover:bg-green-500/20":"bg-card text-muted-foreground hover:text-foreground border border-border hover:bg-muted"}
          ${i}
        `,title:c>0?`${c} history event${c!==1?"s":""}`:"View history",children:[e.jsx(b,{className:"w-4 h-4"}),c>0&&e.jsx("span",{className:"text-[10px] font-semibold tabular-nums",children:c})]}),e.jsx(N,{children:s&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>o(!1)}),e.jsxs(p.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:`relative w-full max-w-md max-h-[80vh] overflow-hidden
                         bg-[#161b22] border border-[#30363d] rounded-2xl shadow-2xl`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-[#30363d] bg-[#0d1117]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-[#238636] to-[#3fb950] flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-[#e6edf3]",children:"Question History"}),e.jsxs("p",{className:"text-xs text-[#8b949e]",children:[c," change",c!==1?"s":""," recorded"]})]})]}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 rounded-lg hover:bg-[#21262d] text-[#8b949e] hover:text-[#e6edf3] transition-colors",children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(80vh-80px)] p-4",children:k?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-3",children:[e.jsx(u,{className:"w-6 h-6 animate-spin text-[#58a6ff]"}),e.jsx("span",{className:"text-sm text-[#8b949e]",children:"Loading history..."})]}):x?.history&&x.history.length>0?e.jsx("div",{className:"space-y-2",children:x.history.map((n,y)=>e.jsx(z,{record:n,isFirst:y===0},`${n.createdAt}-${y}`))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[#21262d] flex items-center justify-center",children:e.jsx(b,{className:"w-8 h-8 text-[#8b949e]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#e6edf3] font-medium mb-1",children:"No History Available"}),e.jsx("p",{className:"text-sm text-[#8b949e] max-w-xs",children:"History tracking shows when questions are created, updated, improved, or verified by our content bots."})]})]})})]})]})})]})}function z({record:t,isFirst:a}){const[r,i]=d.useState(a),s=v[t.eventType]||v.updated,o=s.icon,l=Q[t.eventSource]||w;return e.jsxs(p.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:`
        rounded-xl border ${s.border} ${s.bg} overflow-hidden
        ${a?"ring-2 ring-offset-2 ring-offset-[#161b22] ring-[#30363d]":""}
      `,children:[e.jsxs("button",{onClick:()=>i(!r),className:"w-full flex items-center gap-3 p-3 text-left hover:bg-white/5 transition-colors",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg ${s.bg} border ${s.border} flex items-center justify-center flex-shrink-0`,children:e.jsx(o,{className:`w-4 h-4 ${s.text}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-sm font-semibold ${s.text}`,children:s.label}),e.jsxs("div",{className:"flex items-center gap-1 text-[#8b949e]",children:[e.jsx(l,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px]",children:t.sourceName||t.eventSource})]}),a&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[#238636]/20 text-[#3fb950] font-medium",children:"Latest"})]}),t.changesSummary&&e.jsx("p",{className:"text-xs text-[#8b949e] line-clamp-1",children:t.changesSummary})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[#6e7681]",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px]",children:I(t.createdAt)})]}),e.jsx(R,{className:`w-4 h-4 text-[#6e7681] transition-transform ${r?"rotate-180":""}`})]})]}),e.jsx(N,{children:r&&(t.reason||t.changedFields)&&e.jsx(p.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-[#30363d]/50",children:[t.reason&&e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-[#0d1117] border border-[#30363d] mt-3",children:[e.jsx(D,{className:"w-3.5 h-3.5 text-[#58a6ff] mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-[11px] text-[#8b949e]",children:t.reason})]}),t.changedFields&&t.changedFields.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider",children:"Changed Fields"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1.5",children:t.changedFields.map(h=>e.jsx("span",{className:"px-2 py-0.5 bg-[#58a6ff]/10 text-[#58a6ff] text-[10px] rounded-md border border-[#58a6ff]/30",children:h},h))})]}),e.jsx("div",{className:"flex items-center justify-between pt-2 border-t border-[#30363d]/50",children:e.jsx("span",{className:"text-[10px] text-[#6e7681]",children:new Date(t.createdAt).toLocaleString()})})]})})})]})}export{ee as Q};
