import{j as e,p as Y,r as u,R as _,m as b,t as f,s as h}from"./index-Bb5bc9Dq.js";import{H as d}from"./haptics-U-QSL8hh.js";import{u as H,a as j}from"./use-transform-BkprDROv.js";import{a as k}from"./index-ZyxZLn2f.js";function g({className:l,variant:m="rectangular",animation:s="pulse"}){const o={text:"h-4 rounded",circular:"rounded-full",rectangular:"rounded-lg"},a={pulse:"animate-pulse",wave:"animate-shimmer",none:""};return e.jsx("div",{role:"status","aria-busy":"true","aria-label":"Loading content",className:Y("bg-gray-200 dark:bg-gray-800",o[m],a[s],l)})}function z(){return e.jsx("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-[20px] border border-gray-200 dark:border-gray-800",role:"status","aria-busy":"true","aria-label":"Loading card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(g,{variant:"circular",className:"w-12 h-12 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(g,{className:"h-5 w-3/4"}),e.jsx(g,{className:"h-4 w-full"}),e.jsx(g,{className:"h-4 w-2/3"})]})]})})}function V({count:l=3}){return e.jsx("div",{className:"space-y-4",role:"status","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:l}).map((m,s)=>e.jsx(z,{},s))})}function q({onRefresh:l,children:m,threshold:s=80,disabled:o=!1}){const[a,p]=u.useState(!1),[y,N]=u.useState(!1),[R,x]=u.useState(!1),v=u.useRef(null),w=u.useRef(0),r=H(0),D=j(r,[0,s],[0,360]),S=j(r,[0,s],[0,1]),C=j(r,[0,s],[.5,1]),T=t=>{o||a||(window.scrollY===0||v.current?.scrollTop===0)&&(w.current=t.touches[0].clientY,N(!0),x(!1))},E=t=>{if(!y||o||a)return;const c=t.touches[0].clientY,n=Math.max(0,c-w.current),i=Math.pow(n,.7);r.set(Math.min(i,s*1.5)),i>=s&&!R&&(d.impact(),f("impact","pull_to_refresh_threshold"),x(!0)),n>10&&t.preventDefault()},L=async()=>{if(!y||o)return;N(!1);const t=r.get(),c=Date.now();if(t>=s&&!a){p(!0),k(r,s,{type:"spring",stiffness:300,damping:30});try{await l();const n=Date.now()-c;d.success(),f("success","pull_to_refresh");const i=window.location.pathname;h(i,n,!0)}catch{const i=Date.now()-c;d.error(),f("error","pull_to_refresh");const M=window.location.pathname;h(M,i,!1)}finally{k(r,0,{type:"spring",stiffness:300,damping:30}).then(()=>{p(!1)})}}else k(r,0,{type:"spring",stiffness:300,damping:30});w.current=0,x(!1)},P=async()=>{if(o||a)return;p(!0);const t=Date.now();try{await l();const c=Date.now()-t;d.success(),f("success","keyboard_refresh");const n=window.location.pathname;h(n,c,!0)}catch{const n=Date.now()-t;d.error(),f("error","keyboard_refresh");const i=window.location.pathname;h(i,n,!1)}finally{p(!1)}};return u.useEffect(()=>{const t=v.current;if(t)return t.addEventListener("touchstart",T,{passive:!0}),t.addEventListener("touchmove",E,{passive:!1}),t.addEventListener("touchend",L),()=>{t.removeEventListener("touchstart",T),t.removeEventListener("touchmove",E),t.removeEventListener("touchend",L)}},[y,a,o,R]),e.jsxs("div",{ref:v,className:"relative h-full overflow-auto","data-component":"PullToRefresh",children:[e.jsx("div",{className:"sticky top-0 z-20 flex justify-center py-2 bg-background/80 backdrop-blur-sm border-b border-border",children:e.jsxs("button",{onClick:P,disabled:o||a,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-primary bg-primary/10 hover:bg-primary/20 disabled:opacity-50 disabled:cursor-not-allowed rounded-full transition-colors","aria-label":"Refresh content",children:[e.jsx(_,{className:`w-4 h-4 ${a?"animate-spin":""}`}),e.jsx("span",{children:a?"Refreshing...":"Refresh"})]})}),e.jsx(b.div,{style:{y:r,opacity:S,scale:C},className:"absolute top-0 left-0 right-0 flex justify-center items-center h-20 -mt-20 z-10",children:e.jsx(b.div,{style:{rotate:D},className:"w-8 h-8 flex items-center justify-center",children:e.jsx(_,{className:`w-6 h-6 text-primary ${a?"animate-spin":""}`})})}),e.jsx(b.div,{style:{y:r},children:m})]})}export{q as P,z as S,V as a};
