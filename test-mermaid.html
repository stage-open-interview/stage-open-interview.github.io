<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mermaid Diagram Test</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #000;
      color: #fff;
      font-family: monospace;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #333;
      border-radius: 8px;
      background: #111;
    }
    .test-section h2 {
      color: #00ff88;
      margin-top: 0;
    }
    .diagram-container {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 8px;
      margin: 10px 0;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .status.success {
      background: #00ff8820;
      border: 1px solid #00ff88;
      color: #00ff88;
    }
    .status.error {
      background: #ff008020;
      border: 1px solid #ff0080;
      color: #ff0080;
    }
    .status.loading {
      background: #00d4ff20;
      border: 1px solid #00d4ff;
      color: #00d4ff;
    }
    pre {
      background: #0a0a0a;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    button {
      background: #00ff88;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: #00d4ff;
    }
    .spinner {
      border: 3px solid #333;
      border-top: 3px solid #00ff88;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üî¨ Mermaid Diagram Test Suite</h1>
    <p>Testing Mermaid diagram rendering with different configurations</p>

    <!-- Test 1: CDN Version -->
    <div class="test-section">
      <h2>Test 1: CDN Version (Simple Flowchart)</h2>
      <div id="status1" class="status loading">‚è≥ Loading...</div>
      <div id="diagram1" class="diagram-container">
        <div class="spinner"></div>
      </div>
      <button onclick="runTest1()">Retry Test 1</button>
      <details>
        <summary>View Code</summary>
        <pre id="code1"></pre>
      </details>
    </div>

    <!-- Test 2: NPM Version -->
    <div class="test-section">
      <h2>Test 2: NPM Import (Complex Flowchart)</h2>
      <div id="status2" class="status loading">‚è≥ Loading...</div>
      <div id="diagram2" class="diagram-container">
        <div class="spinner"></div>
      </div>
      <button onclick="runTest2()">Retry Test 2</button>
      <details>
        <summary>View Code</summary>
        <pre id="code2"></pre>
      </details>
    </div>

    <!-- Test 3: With Theme -->
    <div class="test-section">
      <h2>Test 3: Dark Theme Configuration</h2>
      <div id="status3" class="status loading">‚è≥ Loading...</div>
      <div id="diagram3" class="diagram-container">
        <div class="spinner"></div>
      </div>
      <button onclick="runTest3()">Retry Test 3</button>
      <details>
        <summary>View Code</summary>
        <pre id="code3"></pre>
      </details>
    </div>

    <!-- Test 4: Sequence Diagram -->
    <div class="test-section">
      <h2>Test 4: Sequence Diagram</h2>
      <div id="status4" class="status loading">‚è≥ Loading...</div>
      <div id="diagram4" class="diagram-container">
        <div class="spinner"></div>
      </div>
      <button onclick="runTest4()">Retry Test 4</button>
      <details>
        <summary>View Code</summary>
        <pre id="code4"></pre>
      </details>
    </div>

    <!-- Console Output -->
    <div class="test-section">
      <h2>üìã Console Output</h2>
      <pre id="console-output" style="max-height: 300px; overflow-y: auto;"></pre>
      <button onclick="clearConsole()">Clear Console</button>
    </div>
  </div>

  <!-- Load Mermaid from CDN -->
  <script type="module">
    // Capture console logs
    const consoleOutput = document.getElementById('console-output');
    const originalLog = console.log;
    const originalError = console.error;
    
    function addToConsole(type, ...args) {
      const timestamp = new Date().toLocaleTimeString();
      const message = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      consoleOutput.textContent += `[${timestamp}] ${type}: ${message}\n`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
    
    console.log = (...args) => {
      originalLog(...args);
      addToConsole('LOG', ...args);
    };
    
    console.error = (...args) => {
      originalError(...args);
      addToConsole('ERROR', ...args);
    };

    window.clearConsole = () => {
      consoleOutput.textContent = '';
    };

    console.log('üöÄ Starting Mermaid tests...');

    // Test 1: CDN Version
    window.runTest1 = async () => {
      const diagram1 = document.getElementById('diagram1');
      const status1 = document.getElementById('status1');
      const code1 = document.getElementById('code1');
      
      const mermaidCode = `flowchart TD
    A[Start] --> B{Is it working?}
    B -->|Yes| C[Great!]
    B -->|No| D[Debug]
    D --> A`;
      
      code1.textContent = mermaidCode;
      
      try {
        status1.className = 'status loading';
        status1.textContent = '‚è≥ Rendering...';
        diagram1.innerHTML = '<div class="spinner"></div>';
        
        console.log('Test 1: Loading Mermaid from CDN...');
        
        // Import mermaid
        const mermaid = (await import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs')).default;
        
        console.log('Test 1: Mermaid loaded, initializing...');
        
        mermaid.initialize({
          startOnLoad: false,
          theme: 'dark',
        });
        
        console.log('Test 1: Rendering diagram...');
        
        const { svg } = await mermaid.render('diagram1-svg', mermaidCode);
        
        diagram1.innerHTML = svg;
        status1.className = 'status success';
        status1.textContent = '‚úÖ Success! Diagram rendered from CDN';
        
        console.log('Test 1: ‚úÖ Success!');
      } catch (err) {
        console.error('Test 1: ‚ùå Error:', err);
        diagram1.innerHTML = `<div style="color: #ff0080;">Error: ${err.message}</div>`;
        status1.className = 'status error';
        status1.textContent = `‚ùå Error: ${err.message}`;
      }
    };

    // Test 2: NPM Version (simulated)
    window.runTest2 = async () => {
      const diagram2 = document.getElementById('diagram2');
      const status2 = document.getElementById('status2');
      const code2 = document.getElementById('code2');
      
      const mermaidCode = `flowchart LR
    subgraph "Declarative Approach"
        A[Define Desired State] --> B[kubectl apply]
        B --> C[Kubernetes Reconciles]
        C --> D[Cluster Matches State]
    end
    
    subgraph "Imperative Approach"
        E[Execute Commands] --> F[kubectl create/delete]
        F --> G[Direct Changes]
        G --> H[Manual Tracking]
    end`;
      
      code2.textContent = mermaidCode;
      
      try {
        status2.className = 'status loading';
        status2.textContent = '‚è≥ Rendering...';
        diagram2.innerHTML = '<div class="spinner"></div>';
        
        console.log('Test 2: Loading Mermaid...');
        
        const mermaid = (await import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs')).default;
        
        console.log('Test 2: Initializing with default theme...');
        
        mermaid.initialize({
          startOnLoad: false,
          theme: 'default',
        });
        
        console.log('Test 2: Rendering complex diagram...');
        
        const { svg } = await mermaid.render('diagram2-svg', mermaidCode);
        
        diagram2.innerHTML = svg;
        status2.className = 'status success';
        status2.textContent = '‚úÖ Success! Complex diagram rendered';
        
        console.log('Test 2: ‚úÖ Success!');
      } catch (err) {
        console.error('Test 2: ‚ùå Error:', err);
        diagram2.innerHTML = `<div style="color: #ff0080;">Error: ${err.message}</div>`;
        status2.className = 'status error';
        status2.textContent = `‚ùå Error: ${err.message}`;
      }
    };

    // Test 3: With Custom Theme
    window.runTest3 = async () => {
      const diagram3 = document.getElementById('diagram3');
      const status3 = document.getElementById('status3');
      const code3 = document.getElementById('code3');
      
      const mermaidCode = `graph TD
    A[Client] -->|Request| B[Load Balancer]
    B --> C[Server 1]
    B --> D[Server 2]
    B --> E[Server 3]
    C --> F[Database]
    D --> F
    E --> F`;
      
      code3.textContent = mermaidCode;
      
      try {
        status3.className = 'status loading';
        status3.textContent = '‚è≥ Rendering...';
        diagram3.innerHTML = '<div class="spinner"></div>';
        
        console.log('Test 3: Loading Mermaid...');
        
        const mermaid = (await import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs')).default;
        
        console.log('Test 3: Initializing with custom dark theme...');
        
        mermaid.initialize({
          startOnLoad: false,
          theme: 'dark',
          themeVariables: {
            primaryColor: '#00ff88',
            primaryTextColor: '#ffffff',
            primaryBorderColor: '#00d4ff',
            lineColor: '#00d4ff',
            secondaryColor: '#00d4ff',
            tertiaryColor: '#1a1a1a',
            background: '#000000',
            mainBkg: '#1a1a1a',
            secondBkg: '#0a0a0a',
            textColor: '#ffffff',
            fontSize: '16px',
          },
          flowchart: {
            htmlLabels: true,
            curve: 'basis',
          },
        });
        
        console.log('Test 3: Rendering with custom theme...');
        
        const { svg } = await mermaid.render('diagram3-svg', mermaidCode);
        
        diagram3.innerHTML = svg;
        status3.className = 'status success';
        status3.textContent = '‚úÖ Success! Custom theme applied';
        
        console.log('Test 3: ‚úÖ Success!');
      } catch (err) {
        console.error('Test 3: ‚ùå Error:', err);
        diagram3.innerHTML = `<div style="color: #ff0080;">Error: ${err.message}</div>`;
        status3.className = 'status error';
        status3.textContent = `‚ùå Error: ${err.message}`;
      }
    };

    // Test 4: Sequence Diagram
    window.runTest4 = async () => {
      const diagram4 = document.getElementById('diagram4');
      const status4 = document.getElementById('status4');
      const code4 = document.getElementById('code4');
      
      const mermaidCode = `sequenceDiagram
    participant User
    participant Browser
    participant Server
    participant Database
    
    User->>Browser: Click button
    Browser->>Server: HTTP Request
    Server->>Database: Query data
    Database-->>Server: Return results
    Server-->>Browser: JSON Response
    Browser-->>User: Display data`;
      
      code4.textContent = mermaidCode;
      
      try {
        status4.className = 'status loading';
        status4.textContent = '‚è≥ Rendering...';
        diagram4.innerHTML = '<div class="spinner"></div>';
        
        console.log('Test 4: Loading Mermaid...');
        
        const mermaid = (await import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs')).default;
        
        console.log('Test 4: Initializing...');
        
        mermaid.initialize({
          startOnLoad: false,
          theme: 'dark',
        });
        
        console.log('Test 4: Rendering sequence diagram...');
        
        const { svg } = await mermaid.render('diagram4-svg', mermaidCode);
        
        diagram4.innerHTML = svg;
        status4.className = 'status success';
        status4.textContent = '‚úÖ Success! Sequence diagram rendered';
        
        console.log('Test 4: ‚úÖ Success!');
      } catch (err) {
        console.error('Test 4: ‚ùå Error:', err);
        diagram4.innerHTML = `<div style="color: #ff0080;">Error: ${err.message}</div>`;
        status4.className = 'status error';
        status4.textContent = `‚ùå Error: ${err.message}`;
      }
    };

    // Auto-run all tests on load
    console.log('üéØ Auto-running all tests...');
    setTimeout(() => {
      runTest1();
      setTimeout(() => runTest2(), 500);
      setTimeout(() => runTest3(), 1000);
      setTimeout(() => runTest4(), 1500);
    }, 100);
  </script>
</body>
</html>
